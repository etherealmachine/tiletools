import{s as Fe,r as Le,b as Ie,f as Ye}from"../chunks/scheduler.b8ee1aee.js";import{S as Re,i as qe,g as v,m as we,s as Y,r as z,h as w,j as D,n as Te,f as g,c as X,u as F,y as je,k as j,z as Ne,l as B,a as ne,x as d,v as R,A as Xe,B as E,o as Be,d as L,p as Ae,b as Oe,t as O,w as q,C as Ge,D as Ke}from"../chunks/index.b64d0558.js";import{e as Se,T as Ze}from"../chunks/TilesetEditor.e794002d.js";import{I as te}from"../chunks/Icon.101b12af.js";import{T as We}from"../chunks/Tilemap.cf4854d6.js";import{d as $e,a as Je}from"../chunks/Tileset.25979cb8.js";function He(r,l,t){const e=r.slice();return e[40]=l[t],e[42]=t,e}function Qe(r){let l,t=r[40].name+"",e,s,p,u,i,f,h,T;function P(){return r[32](r[42])}const o=[tt,et],c=[];function N(b,C){return b[40].visible?0:1}u=N(r),i=c[u]=o[u](r);function k(){return r[33](r[42])}return{c(){l=v("button"),e=we(t),s=Y(),p=v("button"),i.c(),this.h()},l(b){l=w(b,"BUTTON",{});var C=D(l);e=Te(C,t),C.forEach(g),s=X(b),p=w(b,"BUTTON",{});var W=D(p);i.l(W),W.forEach(g),this.h()},h(){Ne(l,"selected",r[0].selectedLayer===r[42])},m(b,C){ne(b,l,C),d(l,e),ne(b,s,C),ne(b,p,C),c[u].m(p,null),f=!0,h||(T=[E(l,"click",P),E(p,"click",k)],h=!0)},p(b,C){r=b,(!f||C[0]&1)&&t!==(t=r[40].name+"")&&Be(e,t),(!f||C[0]&1)&&Ne(l,"selected",r[0].selectedLayer===r[42]);let W=u;u=N(r),u!==W&&(Ae(),O(c[W],1,1,()=>{c[W]=null}),Oe(),i=c[u],i||(i=c[u]=o[u](r),i.c()),L(i,1),i.m(p,null))},i(b){f||(L(i),f=!0)},o(b){O(i),f=!1},d(b){b&&(g(l),g(s),g(p)),c[u].d(),h=!1,Le(T)}}}function xe(r){let l,t,e,s,p,u,i,f,h;function T(...o){return r[30](r[42],...o)}u=new te({props:{name:"minus"}});function P(){return r[31](r[42])}return{c(){l=v("input"),s=Y(),p=v("button"),z(u.$$.fragment),this.h()},l(o){l=w(o,"INPUT",{placeholder:!0}),s=X(o),p=w(o,"BUTTON",{});var c=D(p);F(u.$$.fragment,c),c.forEach(g),this.h()},h(){j(l,"placeholder",t=r[40].name),l.value=e=r[40].name},m(o,c){ne(o,l,c),ne(o,s,c),ne(o,p,c),R(u,p,null),i=!0,f||(h=[E(l,"change",T),E(p,"click",P)],f=!0)},p(o,c){r=o,(!i||c[0]&1&&t!==(t=r[40].name))&&j(l,"placeholder",t),(!i||c[0]&1&&e!==(e=r[40].name)&&l.value!==e)&&(l.value=e)},i(o){i||(L(u.$$.fragment,o),i=!0)},o(o){O(u.$$.fragment,o),i=!1},d(o){o&&(g(l),g(s),g(p)),q(u),f=!1,Le(h)}}}function et(r){let l,t;return l=new te({props:{name:"eyeOff"}}),{c(){z(l.$$.fragment)},l(e){F(l.$$.fragment,e)},m(e,s){R(l,e,s),t=!0},i(e){t||(L(l.$$.fragment,e),t=!0)},o(e){O(l.$$.fragment,e),t=!1},d(e){q(l,e)}}}function tt(r){let l,t;return l=new te({props:{name:"eyeEmpty"}}),{c(){z(l.$$.fragment)},l(e){F(l.$$.fragment,e)},m(e,s){R(l,e,s),t=!0},i(e){t||(L(l.$$.fragment,e),t=!0)},o(e){O(l.$$.fragment,e),t=!1},d(e){q(l,e)}}}function ze(r){let l,t,e,s;const p=[xe,Qe],u=[];function i(f,h){return f[7]?0:1}return t=i(r),e=u[t]=p[t](r),{c(){l=v("div"),e.c()},l(f){l=w(f,"DIV",{});var h=D(l);e.l(h),h.forEach(g)},m(f,h){ne(f,l,h),u[t].m(l,null),s=!0},p(f,h){let T=t;t=i(f),t===T?u[t].p(f,h):(Ae(),O(u[T],1,1,()=>{u[T]=null}),Oe(),e=u[t],e?e.p(f,h):(e=u[t]=p[t](f),e.c()),L(e,1),e.m(l,null))},i(f){s||(L(e),s=!0)},o(f){O(e),s=!1},d(f){f&&g(l),u[t].d()}}}function nt(r){let l,t,e,s,p,u,i,f,h,T,P,o,c,N,k,b,C="Name",W,$,he,re,G,_e,le,Z,ge,oe,J,be,se,ye,H,ie,A,ke,M,ae,Q,ve,pe,fe,x,n,U,ee;c=new te({props:{name:"erase"}}),G=new te({props:{name:"undo"}}),Z=new te({props:{name:"redo"}}),J=new te({props:{name:"saveFloppyDisk"}}),Q=new te({props:{name:"editPencil"}});let K=Se(r[0].layers),y=[];for(let a=0;a<K.length;a+=1)y[a]=ze(He(r,K,a));const I=a=>O(y[a],1,1,()=>{y[a]=null});return x=new te({props:{name:"plus"}}),{c(){l=v("div"),t=v("div"),e=v("label"),s=v("input"),p=we(`
      Grid`),u=Y(),i=v("span"),f=we(r[1]),h=we(", "),T=we(r[2]),P=Y(),o=v("button"),z(c.$$.fragment),N=Y(),k=v("div"),b=v("label"),b.textContent=C,W=Y(),$=v("input"),he=Y(),re=v("button"),z(G.$$.fragment),_e=Y(),le=v("button"),z(Z.$$.fragment),ge=Y(),oe=v("button"),z(J.$$.fragment),be=Y(),se=v("input"),ye=Y(),H=v("div"),ie=v("div"),A=v("canvas"),ke=Y(),M=v("div"),ae=v("button"),z(Q.$$.fragment),ve=Y();for(let a=0;a<y.length;a+=1)y[a].c();pe=Y(),fe=v("button"),z(x.$$.fragment),this.h()},l(a){l=w(a,"DIV",{style:!0});var _=D(l);t=w(_,"DIV",{style:!0});var m=D(t);e=w(m,"LABEL",{});var V=D(e);s=w(V,"INPUT",{type:!0}),p=Te(V,`
      Grid`),V.forEach(g),u=X(m),i=w(m,"SPAN",{});var S=D(i);f=Te(S,r[1]),h=Te(S,", "),T=Te(S,r[2]),S.forEach(g),P=X(m),o=w(m,"BUTTON",{});var Ee=D(o);F(c.$$.fragment,Ee),Ee.forEach(g),N=X(m),k=w(m,"DIV",{style:!0});var me=D(k);b=w(me,"LABEL",{for:!0,"data-svelte-h":!0}),je(b)!=="svelte-bs9sy6"&&(b.textContent=C),W=X(me),$=w(me,"INPUT",{name:!0,type:!0}),me.forEach(g),he=X(m),re=w(m,"BUTTON",{});var ue=D(re);F(G.$$.fragment,ue),ue.forEach(g),_e=X(m),le=w(m,"BUTTON",{});var ce=D(le);F(Z.$$.fragment,ce),ce.forEach(g),ge=X(m),oe=w(m,"BUTTON",{});var Pe=D(oe);F(J.$$.fragment,Pe),Pe.forEach(g),be=X(m),se=w(m,"INPUT",{type:!0,accept:!0}),m.forEach(g),ye=X(_),H=w(_,"DIV",{style:!0});var De=D(H);ie=w(De,"DIV",{class:!0});var Ce=D(ie);A=w(Ce,"CANVAS",{style:!0,tabindex:!0}),D(A).forEach(g),Ce.forEach(g),ke=X(De),M=w(De,"DIV",{style:!0});var de=D(M);ae=w(de,"BUTTON",{});var Me=D(ae);F(Q.$$.fragment,Me),Me.forEach(g),ve=X(de);for(let Ue=0;Ue<y.length;Ue+=1)y[Ue].l(de);pe=X(de),fe=w(de,"BUTTON",{});var Ve=D(fe);F(x.$$.fragment,Ve),Ve.forEach(g),de.forEach(g),De.forEach(g),_.forEach(g),this.h()},h(){j(s,"type","checkbox"),Ne(o,"active",r[6]),j(b,"for","name"),j($,"name","name"),j($,"type","text"),B(k,"display","flex"),B(k,"flex-direction","column"),B(k,"align-items","start"),j(se,"type","file"),j(se,"accept","image/png"),B(t,"display","flex"),B(t,"gap","8px"),B(A,"position","absolute"),j(A,"tabindex","1"),j(ie,"class","canvas svelte-16cu0gi"),B(M,"display","flex"),B(M,"flex-direction","column"),B(M,"gap","4px"),B(H,"display","flex"),B(H,"flex-grow","1"),B(l,"display","flex"),B(l,"flex-direction","column"),B(l,"flex-grow","1")},m(a,_){ne(a,l,_),d(l,t),d(t,e),d(e,s),s.checked=r[3],d(e,p),d(t,u),d(t,i),d(i,f),d(i,h),d(i,T),d(t,P),d(t,o),R(c,o,null),d(t,N),d(t,k),d(k,b),d(k,W),d(k,$),Xe($,r[0].name),d(t,he),d(t,re),R(G,re,null),d(t,_e),d(t,le),R(Z,le,null),d(t,ge),d(t,oe),R(J,oe,null),d(t,be),d(t,se),d(l,ye),d(l,H),d(H,ie),d(ie,A),r[26](A),d(H,ke),d(H,M),d(M,ae),R(Q,ae,null),d(M,ve);for(let m=0;m<y.length;m+=1)y[m]&&y[m].m(M,null);d(M,pe),d(M,fe),R(x,fe,null),n=!0,U||(ee=[E(s,"change",r[20]),E(o,"click",r[21]),E($,"input",r[22]),E(re,"click",r[23]),E(le,"click",r[24]),E(oe,"click",r[25]),E(se,"change",r[14]),E(A,"wheel",r[12]),E(A,"pointerdown",r[8]),E(A,"pointerup",r[9]),E(A,"pointercancel",r[10]),E(A,"pointermove",r[11]),E(A,"keydown",r[13]),E(A,"pointerenter",r[27]),E(A,"pointerleave",r[28]),E(ae,"click",r[29]),E(fe,"click",r[34])],U=!0)},p(a,_){if(_[0]&8&&(s.checked=a[3]),(!n||_[0]&2)&&Be(f,a[1]),(!n||_[0]&4)&&Be(T,a[2]),(!n||_[0]&64)&&Ne(o,"active",a[6]),_[0]&1&&$.value!==a[0].name&&Xe($,a[0].name),_[0]&129){K=Se(a[0].layers);let m;for(m=0;m<K.length;m+=1){const V=He(a,K,m);y[m]?(y[m].p(V,_),L(y[m],1)):(y[m]=ze(V),y[m].c(),L(y[m],1),y[m].m(M,pe))}for(Ae(),m=K.length;m<y.length;m+=1)I(m);Oe()}},i(a){if(!n){L(c.$$.fragment,a),L(G.$$.fragment,a),L(Z.$$.fragment,a),L(J.$$.fragment,a),L(Q.$$.fragment,a);for(let _=0;_<K.length;_+=1)L(y[_]);L(x.$$.fragment,a),n=!0}},o(a){O(c.$$.fragment,a),O(G.$$.fragment,a),O(Z.$$.fragment,a),O(J.$$.fragment,a),O(Q.$$.fragment,a),y=y.filter(Boolean);for(let _=0;_<y.length;_+=1)O(y[_]);O(x.$$.fragment,a),n=!1},d(a){a&&g(l),q(c),q(G),q(Z),q(J),r[26](null),q(Q),Ge(y,a),q(x),U=!1,Le(ee)}}}function rt(r,l,t){let{map:e=new We}=l,s,p=!1,u=!1,i,f,h,T,P=!0,o=1,c=!1,N=0,k=0;function b(n,U){return[(n-N)/o,(U-k)/o]}function C(n,U){const[ee,K]=b(n,U);return e.tileset?e.tileset.worldToTile(ee,K):[0,0]}function W(){var K,y;const n=s.getContext("2d");if(!n)return;const U=(((K=s.parentElement)==null?void 0:K.scrollWidth)||0)-4,ee=(((y=s.parentElement)==null?void 0:y.scrollHeight)||0)-4;if(t(5,s.width=U,s),t(5,s.height=ee,s),n.imageSmoothingEnabled=!1,n.resetTransform(),n.clearRect(0,0,U,ee),n.setTransform(o,0,0,o,N,k),n.strokeStyle="white",P&&e.tileset&&e.tileset.tilewidth>0&&e.tileset.tileheight>0)if(e.tileset.type==="hex"){const I=e.tileset.radius(),a=3/2*I,_=Math.sqrt(3)*I,m=1/2*_;let[V,S]=b(0,0);V=Math.floor(V/a),S=Math.floor(S/_);const[Ee,me]=[s.width/a/o,s.height/_/o];for(let ue=V;ue<=V+Ee;ue++)for(let ce=S;ce<=S+me;ce++)ue%2===0?$e(n,ue*a,ce*_,I):$e(n,ue*a,ce*_+m,I)}else{let[I,a]=b(0,0);I=Math.floor(I/e.tileset.tilewidth),a=Math.floor(a/e.tileset.tileheight);const[_,m]=[s.width/e.tileset.tilewidth/o,s.height/e.tileset.tileheight/o];for(let V=I;V<=I+_;V++)for(let S=a;S<=a+m;S++)Je(n,V*e.tileset.tilewidth,S*e.tileset.tileheight,e.tileset.tilewidth,e.tileset.tileheight)}if(e.tileset){for(let I of e.layers){if(!I.visible)return;e.drawLayer(n,I)}if(i!==void 0&&f!==void 0&&c){const I=e.tileset.randSelectedTile();I&&e.tileset.drawTile(n,i,f,I[0],I[1])}}}function $(n){n.buttons===1?(n.ctrlKey||p?e.erase(i,f):n.shiftKey?e.fill(i,f):e.set(i,f),t(0,e)):n.ctrlKey&&(t(18,N+=n.movementX),t(19,k+=n.movementY))}function he(n){t(1,[i,f]=C(n.offsetX,n.offsetY),i,t(2,f)),t(15,[h,T]=[i,f],h,t(16,T)),n.buttons===1&&e.undoer.begin(),$(n)}function re(n){t(15,[h,T]=[void 0,void 0],h,t(16,T)),e.undoer.end()}function G(){t(15,[h,T]=[void 0,void 0],h,t(16,T)),e.undoer.end()}function _e(n){!e.tileset||!e.tileset.img||(t(1,[i,f]=C(n.offsetX,n.offsetY),i,t(2,f)),$(n))}function le(n){const U=o;n.deltaY<0?t(17,o*=1.1):n.deltaY>0&&t(17,o*=.9),t(17,o=Math.min(Math.max(.25,o),8)),t(18,N=-o*(n.offsetX-N)/U+n.offsetX),t(19,k=-o*(n.offsetY-k)/U+n.offsetY)}function Z(n){if(e.tileset&&c)switch(!0){case n.key==="e":t(6,p=!0),n.preventDefault();break;case(n.key==="z"&&n.ctrlKey):e.undo(),n.preventDefault();break;case(n.key==="y"&&n.ctrlKey):e.redo(),n.preventDefault();break;case(n.key==="s"&&n.ctrlKey):e.download(),n.preventDefault();break;case n.key==="ArrowLeft":t(18,N+=o*e.tileset.offsetWidth()),n.preventDefault();break;case n.key==="ArrowRight":t(18,N-=o*e.tileset.offsetWidth()),n.preventDefault();break;case n.key==="ArrowUp":t(19,k+=o*e.tileset.offsetHeight()),n.preventDefault();break;case n.key==="ArrowDown":t(19,k-=o*e.tileset.offsetHeight()),n.preventDefault();break}}function ge(n){if(n.target===null)return;const U=n.target.files;if(U===null)return;const ee=U[0];We.loadFromFile(ee).then(K=>{t(0,e=K)})}function oe(...n){e.tileset&&e.tileset.img&&requestAnimationFrame(W)}function J(){P=this.checked,t(3,P)}const be=()=>{t(6,p=!p)};function se(){e.name=this.value,t(0,e)}const ye=()=>{e.undo(),t(0,e)},H=()=>{e.redo(),t(0,e)},ie=()=>e.download();function A(n){Ie[n?"unshift":"push"](()=>{s=n,t(5,s)})}const ke=()=>{s.focus(),t(4,c=!0)},M=()=>{t(4,c=!1)},ae=()=>{t(7,u=!u)},Q=(n,U)=>{t(0,e.layers[n].name=U.currentTarget.value,e),t(0,e)},ve=n=>{e.removeLayer(n),t(0,e)},pe=n=>{t(0,e.selectedLayer=n,e),t(0,e)},fe=n=>{t(0,e.layers[n].visible=!e.layers[n].visible,e),t(0,e)},x=()=>{e.addLayer(),t(0,e)};return r.$$set=n=>{"map"in n&&t(0,e=n.map)},r.$$.update=()=>{r.$$.dirty[0]&1015839&&oe(e,P,o,N,k,h,T,i,f,c)},[e,i,f,P,c,s,p,u,he,re,G,_e,le,Z,ge,h,T,o,N,k,J,be,se,ye,H,ie,A,ke,M,ae,Q,ve,pe,fe,x]}class lt extends Re{constructor(l){super(),qe(this,l,rt,nt,Fe,{map:0},null,[-1,-1])}}function ot(r){let l,t,e,s,p,u,i;function f(o){r[2](o)}let h={maxWidth:"30%"};r[0]!==void 0&&(h.tileset=r[0]),t=new Ze({props:h}),Ie.push(()=>Ke(t,"tileset",f));function T(o){r[3](o)}let P={};return r[1]!==void 0&&(P.map=r[1]),p=new lt({props:P}),Ie.push(()=>Ke(p,"map",T)),{c(){l=v("div"),z(t.$$.fragment),s=Y(),z(p.$$.fragment),this.h()},l(o){l=w(o,"DIV",{style:!0});var c=D(l);F(t.$$.fragment,c),s=X(c),F(p.$$.fragment,c),c.forEach(g),this.h()},h(){B(l,"display","flex"),B(l,"gap","16px"),B(l,"justify-content","space-between"),B(l,"width","100%")},m(o,c){ne(o,l,c),R(t,l,null),d(l,s),R(p,l,null),i=!0},p(o,[c]){const N={};!e&&c&1&&(e=!0,N.tileset=o[0],Ye(()=>e=!1)),t.$set(N);const k={};!u&&c&2&&(u=!0,k.map=o[1],Ye(()=>u=!1)),p.$set(k)},i(o){i||(L(t.$$.fragment,o),L(p.$$.fragment,o),i=!0)},o(o){O(t.$$.fragment,o),O(p.$$.fragment,o),i=!1},d(o){o&&g(l),q(t),q(p)}}}function st(r,l){r&&(r.tileset=l),r&&r.tileset&&(l=r.tileset)}function it(r,l,t){let e,s;function p(i){e=i,t(0,e)}function u(i){s=i,t(1,s)}return r.$$.update=()=>{r.$$.dirty&3&&st(s,e)},[e,s,p,u]}class dt extends Re{constructor(l){super(),qe(this,l,it,ot,Fe,{})}}export{dt as component};
