import{s as lt,r as Pe,b as Oe,f as je,o as ft}from"../chunks/scheduler.9c0c050a.js";import{S as ot,i as it,g as v,m as at,s as O,r as W,h as w,j as S,n as st,f as b,c as L,u as F,y as ut,k as le,z as G,l as P,a as de,x as p,v as V,A as Ze,B as D,d as U,p as Ae,b as Ce,t as N,w as R,C as ct,o as dt,D as Je}from"../chunks/index.0d064376.js";import{T as Le}from"../chunks/Tilemap.04daf4f8.js";import{e as Qe,T as mt}from"../chunks/TilesetEditor.a452e9b2.js";import{I as z}from"../chunks/Icon.7d205c32.js";import{P as ce,d as xe,a as et}from"../chunks/Tileset.96cf75fd.js";function tt(n,l,t){const e=n.slice();return e[42]=l[t],e[44]=t,e}function ht(n){let l,t=n[42].name+"",e,s,d,m,h,f,y,T;function _(){return n[34](n[44])}const o=[gt,_t],i=[];function A(k,B){return k[42].visible?0:1}m=A(n),h=i[m]=o[m](n);function j(){return n[35](n[44])}return{c(){l=v("button"),e=at(t),s=O(),d=v("button"),h.c(),this.h()},l(k){l=w(k,"BUTTON",{});var B=S(l);e=st(B,t),B.forEach(b),s=L(k),d=w(k,"BUTTON",{});var H=S(d);h.l(H),H.forEach(b),this.h()},h(){G(l,"selected",n[0].selectedLayer===n[44])},m(k,B){de(k,l,B),p(l,e),de(k,s,B),de(k,d,B),i[m].m(d,null),f=!0,y||(T=[D(l,"click",_),D(d,"click",j)],y=!0)},p(k,B){n=k,(!f||B[0]&1)&&t!==(t=n[42].name+"")&&dt(e,t),(!f||B[0]&1)&&G(l,"selected",n[0].selectedLayer===n[44]);let H=m;m=A(n),m!==H&&(Ae(),N(i[H],1,1,()=>{i[H]=null}),Ce(),h=i[m],h||(h=i[m]=o[m](n),h.c()),U(h,1),h.m(d,null))},i(k){f||(U(h),f=!0)},o(k){N(h),f=!1},d(k){k&&(b(l),b(s),b(d)),i[m].d(),y=!1,Pe(T)}}}function pt(n){let l,t,e,s,d,m,h,f,y;function T(...o){return n[32](n[44],...o)}m=new z({props:{name:"minus"}});function _(){return n[33](n[44])}return{c(){l=v("input"),s=O(),d=v("button"),W(m.$$.fragment),this.h()},l(o){l=w(o,"INPUT",{placeholder:!0}),s=L(o),d=w(o,"BUTTON",{});var i=S(d);F(m.$$.fragment,i),i.forEach(b),this.h()},h(){le(l,"placeholder",t=n[42].name),l.value=e=n[42].name},m(o,i){de(o,l,i),de(o,s,i),de(o,d,i),V(m,d,null),h=!0,f||(y=[D(l,"change",T),D(d,"click",_)],f=!0)},p(o,i){n=o,(!h||i[0]&1&&t!==(t=n[42].name))&&le(l,"placeholder",t),(!h||i[0]&1&&e!==(e=n[42].name)&&l.value!==e)&&(l.value=e)},i(o){h||(U(m.$$.fragment,o),h=!0)},o(o){N(m.$$.fragment,o),h=!1},d(o){o&&(b(l),b(s),b(d)),R(m),f=!1,Pe(y)}}}function _t(n){let l,t;return l=new z({props:{name:"eyeOff"}}),{c(){W(l.$$.fragment)},l(e){F(l.$$.fragment,e)},m(e,s){V(l,e,s),t=!0},i(e){t||(U(l.$$.fragment,e),t=!0)},o(e){N(l.$$.fragment,e),t=!1},d(e){R(l,e)}}}function gt(n){let l,t;return l=new z({props:{name:"eyeEmpty"}}),{c(){W(l.$$.fragment)},l(e){F(l.$$.fragment,e)},m(e,s){V(l,e,s),t=!0},i(e){t||(U(l.$$.fragment,e),t=!0)},o(e){N(l.$$.fragment,e),t=!1},d(e){R(l,e)}}}function nt(n){let l,t,e,s;const d=[pt,ht],m=[];function h(f,y){return f[5]?0:1}return t=h(n),e=m[t]=d[t](n),{c(){l=v("div"),e.c()},l(f){l=w(f,"DIV",{});var y=S(l);e.l(y),y.forEach(b)},m(f,y){de(f,l,y),m[t].m(l,null),s=!0},p(f,y){let T=t;t=h(f),t===T?m[t].p(f,y):(Ae(),N(m[T],1,1,()=>{m[T]=null}),Ce(),e=m[t],e?e.p(f,y):(e=m[t]=d[t](f),e.c()),U(e,1),e.m(l,null))},i(f){s||(U(e),s=!0)},o(f){N(e),s=!1},d(f){f&&b(l),m[t].d()}}}function bt(n){let l,t,e,s,d,m,h,f,y,T,_,o,i,A,j,k,B,H,Z,oe,ke,K,ie,Ne="Name",ve,J,we,ee,ae,_e,Ee,te,se,ge,Te,me,fe,$e,he,De,Q,pe,C,Se,r,$,I,Y,X,x,ue,M,ne,Ue;f=new z({props:{name:"openSelectHandGesture"}}),_=new z({props:{name:"editPencil"}}),A=new z({props:{name:"erase"}}),B=new z({props:{name:"fillColor"}}),oe=new z({props:{name:"door"}}),ae=new z({props:{name:"undo"}}),se=new z({props:{name:"redo"}}),fe=new z({props:{name:"saveFloppyDisk"}}),I=new z({props:{name:"editPencil"}});let re=Qe(n[0].layers),u=[];for(let a=0;a<re.length;a+=1)u[a]=nt(tt(n,re,a));const q=a=>N(u[a],1,1,()=>{u[a]=null});return ue=new z({props:{name:"plus"}}),{c(){l=v("div"),t=v("div"),e=v("label"),s=v("input"),d=at(`
      Grid`),m=O(),h=v("button"),W(f.$$.fragment),y=O(),T=v("button"),W(_.$$.fragment),o=O(),i=v("button"),W(A.$$.fragment),j=O(),k=v("button"),W(B.$$.fragment),H=O(),Z=v("button"),W(oe.$$.fragment),ke=O(),K=v("div"),ie=v("label"),ie.textContent=Ne,ve=O(),J=v("input"),we=O(),ee=v("button"),W(ae.$$.fragment),Ee=O(),te=v("button"),W(se.$$.fragment),Te=O(),me=v("button"),W(fe.$$.fragment),$e=O(),he=v("input"),De=O(),Q=v("div"),pe=v("div"),C=v("canvas"),Se=O(),r=v("div"),$=v("button"),W(I.$$.fragment),Y=O();for(let a=0;a<u.length;a+=1)u[a].c();X=O(),x=v("button"),W(ue.$$.fragment),this.h()},l(a){l=w(a,"DIV",{style:!0});var g=S(l);t=w(g,"DIV",{style:!0});var c=S(t);e=w(c,"LABEL",{});var be=S(e);s=w(be,"INPUT",{type:!0}),d=st(be,`
      Grid`),be.forEach(b),m=L(c),h=w(c,"BUTTON",{});var We=S(h);F(f.$$.fragment,We),We.forEach(b),y=L(c),T=w(c,"BUTTON",{});var Fe=S(T);F(_.$$.fragment,Fe),Fe.forEach(b),o=L(c),i=w(c,"BUTTON",{});var Ve=S(i);F(A.$$.fragment,Ve),Ve.forEach(b),j=L(c),k=w(c,"BUTTON",{});var Re=S(k);F(B.$$.fragment,Re),Re.forEach(b),H=L(c),Z=w(c,"BUTTON",{});var Ye=S(Z);F(oe.$$.fragment,Ye),Ye.forEach(b),ke=L(c),K=w(c,"DIV",{style:!0});var Be=S(K);ie=w(Be,"LABEL",{for:!0,"data-svelte-h":!0}),ut(ie)!=="svelte-bs9sy6"&&(ie.textContent=Ne),ve=L(Be),J=w(Be,"INPUT",{name:!0,type:!0}),Be.forEach(b),we=L(c),ee=w(c,"BUTTON",{});var ze=S(ee);F(ae.$$.fragment,ze),ze.forEach(b),Ee=L(c),te=w(c,"BUTTON",{});var He=S(te);F(se.$$.fragment,He),He.forEach(b),Te=L(c),me=w(c,"BUTTON",{});var Ke=S(me);F(fe.$$.fragment,Ke),Ke.forEach(b),$e=L(c),he=w(c,"INPUT",{type:!0,accept:!0}),c.forEach(b),De=L(g),Q=w(g,"DIV",{style:!0});var Ie=S(Q);pe=w(Ie,"DIV",{class:!0});var Xe=S(pe);C=w(Xe,"CANVAS",{style:!0,tabindex:!0}),S(C).forEach(b),Xe.forEach(b),Se=L(Ie),r=w(Ie,"DIV",{style:!0});var ye=S(r);$=w(ye,"BUTTON",{});var qe=S($);F(I.$$.fragment,qe),qe.forEach(b),Y=L(ye);for(let Me=0;Me<u.length;Me+=1)u[Me].l(ye);X=L(ye),x=w(ye,"BUTTON",{});var Ge=S(x);F(ue.$$.fragment,Ge),Ge.forEach(b),ye.forEach(b),Ie.forEach(b),g.forEach(b),this.h()},h(){le(s,"type","checkbox"),G(h,"active",n[4]===E.Select),G(T,"active",n[4]===E.Edit),G(i,"active",n[4]===E.Erase),G(k,"active",n[4]===E.Fill),G(Z,"active",n[4]===E.Door),le(ie,"for","name"),le(J,"name","name"),le(J,"type","text"),P(K,"display","flex"),P(K,"flex-direction","column"),P(K,"align-items","start"),ee.disabled=_e=n[0].undoer.undoStack.length===0,te.disabled=ge=n[0].undoer.redoStack.length===0,le(he,"type","file"),le(he,"accept","image/png"),P(t,"display","flex"),P(t,"gap","8px"),P(C,"position","absolute"),le(C,"tabindex","1"),le(pe,"class","canvas svelte-16cu0gi"),P(r,"display","flex"),P(r,"flex-direction","column"),P(r,"gap","4px"),P(Q,"display","flex"),P(Q,"flex-grow","1"),P(l,"display","flex"),P(l,"flex-direction","column"),P(l,"flex-grow","1")},m(a,g){de(a,l,g),p(l,t),p(t,e),p(e,s),s.checked=n[1],p(e,d),p(t,m),p(t,h),V(f,h,null),p(t,y),p(t,T),V(_,T,null),p(t,o),p(t,i),V(A,i,null),p(t,j),p(t,k),V(B,k,null),p(t,H),p(t,Z),V(oe,Z,null),p(t,ke),p(t,K),p(K,ie),p(K,ve),p(K,J),Ze(J,n[0].name),p(t,we),p(t,ee),V(ae,ee,null),p(t,Ee),p(t,te),V(se,te,null),p(t,Te),p(t,me),V(fe,me,null),p(t,$e),p(t,he),p(l,De),p(l,Q),p(Q,pe),p(pe,C),n[28](C),p(Q,Se),p(Q,r),p(r,$),V(I,$,null),p(r,Y);for(let c=0;c<u.length;c+=1)u[c]&&u[c].m(r,null);p(r,X),p(r,x),V(ue,x,null),M=!0,ne||(Ue=[D(s,"change",n[18]),D(h,"click",n[19]),D(T,"click",n[20]),D(i,"click",n[21]),D(k,"click",n[22]),D(Z,"click",n[23]),D(J,"input",n[24]),D(ee,"click",n[25]),D(te,"click",n[26]),D(me,"click",n[27]),D(he,"change",n[13]),D(C,"wheel",n[11]),D(C,"pointerdown",n[7]),D(C,"pointerup",n[8]),D(C,"pointercancel",n[9]),D(C,"pointermove",n[10]),D(C,"keydown",n[12]),D(C,"pointerenter",n[29]),D(C,"pointerleave",n[30]),D($,"click",n[31]),D(x,"click",n[36])],ne=!0)},p(a,g){if(g[0]&2&&(s.checked=a[1]),(!M||g[0]&16)&&G(h,"active",a[4]===E.Select),(!M||g[0]&16)&&G(T,"active",a[4]===E.Edit),(!M||g[0]&16)&&G(i,"active",a[4]===E.Erase),(!M||g[0]&16)&&G(k,"active",a[4]===E.Fill),(!M||g[0]&16)&&G(Z,"active",a[4]===E.Door),g[0]&1&&J.value!==a[0].name&&Ze(J,a[0].name),(!M||g[0]&1&&_e!==(_e=a[0].undoer.undoStack.length===0))&&(ee.disabled=_e),(!M||g[0]&1&&ge!==(ge=a[0].undoer.redoStack.length===0))&&(te.disabled=ge),g[0]&33){re=Qe(a[0].layers);let c;for(c=0;c<re.length;c+=1){const be=tt(a,re,c);u[c]?(u[c].p(be,g),U(u[c],1)):(u[c]=nt(be),u[c].c(),U(u[c],1),u[c].m(r,X))}for(Ae(),c=re.length;c<u.length;c+=1)q(c);Ce()}},i(a){if(!M){U(f.$$.fragment,a),U(_.$$.fragment,a),U(A.$$.fragment,a),U(B.$$.fragment,a),U(oe.$$.fragment,a),U(ae.$$.fragment,a),U(se.$$.fragment,a),U(fe.$$.fragment,a),U(I.$$.fragment,a);for(let g=0;g<re.length;g+=1)U(u[g]);U(ue.$$.fragment,a),M=!0}},o(a){N(f.$$.fragment,a),N(_.$$.fragment,a),N(A.$$.fragment,a),N(B.$$.fragment,a),N(oe.$$.fragment,a),N(ae.$$.fragment,a),N(se.$$.fragment,a),N(fe.$$.fragment,a),N(I.$$.fragment,a),u=u.filter(Boolean);for(let g=0;g<u.length;g+=1)N(u[g]);N(ue.$$.fragment,a),M=!1},d(a){a&&b(l),R(f),R(_),R(A),R(B),R(oe),R(ae),R(se),R(fe),n[28](null),R(I),ct(u,a),R(ue),ne=!1,Pe(Ue)}}}var E=(n=>(n[n.Select=0]="Select",n[n.Edit=1]="Edit",n[n.Erase=2]="Erase",n[n.Fill=3]="Fill",n[n.Door=4]="Door",n))(E||{});function rt(n,l,t,e){l.type==="hex"||(n.lineWidth=2,n.strokeStyle="#FF8000",n.strokeRect(t.x*l.tilewidth,t.y*l.tileheight,l.tilewidth,l.tileheight),n.beginPath(),n.moveTo((t.x+.5)*l.tilewidth,(t.y+.5)*l.tileheight),n.lineTo((e.x+.5)*l.tilewidth,(e.y+.5)*l.tileheight),n.stroke(),n.strokeRect(e.x*l.tilewidth,e.y*l.tileheight,l.tilewidth,l.tileheight))}function yt(n,l,t){let{map:e=new Le}=l,s,d=E.Select,m,h=!1,f=new ce(-1,-1),y,T=!0,_=1,o=!1,i=new ce(0,0);function A(r){return new ce((r.x-i.x)/_,(r.y-i.y)/_)}function j(r){const $=A(r);return e.tileset?e.tileset.worldToTile($):new ce(0,0)}function k(r){t(4,d=r)}function B(){var Ue,re;const r=s.getContext("2d");if(!r)return;const $=(((Ue=s.parentElement)==null?void 0:Ue.scrollWidth)||0)-4,I=(((re=s.parentElement)==null?void 0:re.scrollHeight)||0)-4;t(3,s.width=$,s),t(3,s.height=I,s),r.imageSmoothingEnabled=!1,r.resetTransform(),r.clearRect(0,0,$,I),r.setTransform(_,0,0,_,i.x,i.y),r.lineWidth=1,r.strokeStyle="#ffffff77";const Y=e.tileset.radius(),X=3/2*Y,x=Math.sqrt(3)*Y,ue=1/2*x,M=e.tileset.tilewidth,ne=e.tileset.tileheight;if(T&&M>0&&ne>0)if(e.tileset.type==="hex"){let u=A(new ce(0,0));u.x=Math.floor(u.x/X),u.y=Math.floor(u.y/x);const[q,a]=[s.width/X/_,s.height/x/_];for(let g=u.x;g<=u.x+q;g++)for(let c=u.y;c<=u.y+a;c++)xe(r,g*X,c*x+(g%2===0?0:ue),Y)}else{let u=A(new ce(0,0));u.x=Math.floor(u.x/M),u.y=Math.floor(u.y/ne);const[q,a]=[$/M/_,I/ne/_];for(let g=u.x;g<=u.x+q;g++)for(let c=u.y;c<=u.y+a;c++)et(r,g*M,c*ne,M,ne)}for(let u of e.layers)u.visible&&e.drawLayer(r,u);for(let[u,q]of e.tiledata.filter("door"))rt(r,e.tileset,u,q);if(d===E.Edit&&o){const u=e.tileset.randSelectedTile();u&&e.tileset.drawTile(r,f,u)}d===E.Door&&m&&rt(r,e.tileset,m,f),r.lineWidth=3,r.strokeStyle="white",e.selectedTiles.forEach(u=>{const q=e.tileset.tileToWorld(u);switch(e.tileset.type){case"square":et(r,q.x,q.y,M,ne);break;case"hex":xe(r,q.x,q.y,Y);break}})}function H(r){t(14,f=j(new ce(r.offsetX,r.offsetY))),t(15,y=f.clone()),r.buttons===1&&(d===E.Erase?(e.undoer.begin(),e.erase(f)):d===E.Fill?e.fill(f):d===E.Door&&!m?m=f.clone():d===E.Door&&m?(e.setDoor(f,m),m=void 0):d===E.Edit?(e.undoer.begin(),e.set(f)):d===E.Select&&(r.shiftKey?e.toggleSelectedTile(f):e.setSelectedTile(f)),t(0,e))}function Z(){t(15,y=void 0),e.undoer.end(),t(0,e)}function oe(){Z()}function ke(r){if(t(14,f=j(new ce(r.offsetX,r.offsetY))),r.buttons===1){if(d===E.Erase)e.erase(f);else if(d===E.Edit)e.set(f);else if(d===E.Select&&y!==void 0){e.clearSelectedTiles();let $=y,I=f;for(let Y=Math.min($.x,I.x);Y<=Math.max($.x,I.x);Y++)for(let X=Math.min($.y,I.y);X<=Math.max($.y,I.y);X++)e.addSelectedTile(new ce(Y,X))}t(0,e)}else r.ctrlKey&&(t(17,i.x+=r.movementX,i),t(17,i.y+=r.movementY,i))}function K(r){const $=_;r.deltaY<0?t(16,_*=1.1):r.deltaY>0&&t(16,_*=.9),t(16,_=Math.min(Math.max(.25,_),8)),t(17,i.x=-_*(r.offsetX-i.x)/$+r.offsetX,i),t(17,i.y=-_*(r.offsetY-i.y)/$+r.offsetY,i)}function ie(r){if(e.tileset&&o)switch(!0){case(r.key==="z"&&r.ctrlKey):e.undo(),r.preventDefault();break;case(r.key==="y"&&r.ctrlKey):e.redo(),r.preventDefault();break;case(r.key==="s"&&r.ctrlKey):e.download(),r.preventDefault();break;case r.key==="ArrowLeft":t(17,i.x+=_*e.tileset.offsetWidth(),i),r.preventDefault();break;case r.key==="ArrowRight":t(17,i.x-=_*e.tileset.offsetWidth(),i),r.preventDefault();break;case r.key==="ArrowUp":t(17,i.y+=_*e.tileset.offsetHeight(),i),r.preventDefault();break;case r.key==="ArrowDown":t(17,i.y-=_*e.tileset.offsetHeight(),i),r.preventDefault();break;case(r.key==="Backspace"||r.key==="Delete"):e.clear(),t(0,e),r.preventDefault();break;case r.key==="Escape":e.clearSelectedTiles(),t(0,e),r.preventDefault();break}}function Ne(r){if(r.target===null)return;const $=r.target.files;if($===null)return;const I=$[0];Le.from(I).then(Y=>{t(0,e=Y)})}function ve(...r){e.tileset&&e.tileset.img&&requestAnimationFrame(B)}function J(){T=this.checked,t(1,T)}const we=()=>k(E.Select),ee=()=>k(E.Edit),ae=()=>k(E.Erase),_e=()=>k(E.Fill),Ee=()=>k(E.Door);function te(){e.name=this.value,t(0,e)}const se=()=>{e.undo(),t(0,e)},ge=()=>{e.redo(),t(0,e)},Te=()=>e.download();function me(r){Oe[r?"unshift":"push"](()=>{s=r,t(3,s)})}const fe=()=>{s.focus(),t(2,o=!0)},$e=()=>{t(2,o=!1)},he=()=>{t(5,h=!h)},De=(r,$)=>{t(0,e.layers[r].name=$.currentTarget.value,e),t(0,e)},Q=r=>{e.removeLayer(r),t(0,e)},pe=r=>{t(0,e.selectedLayer=r,e),t(0,e)},C=r=>{t(0,e.layers[r].visible=!e.layers[r].visible,e),t(0,e)},Se=()=>{e.addLayer(),t(0,e)};return n.$$set=r=>{"map"in r&&t(0,e=r.map)},n.$$.update=()=>{n.$$.dirty[0]&245767&&ve(e,T,_,i,y,f,o)},[e,T,o,s,d,h,k,H,Z,oe,ke,K,ie,Ne,f,y,_,i,J,we,ee,ae,_e,Ee,te,se,ge,Te,me,fe,$e,he,De,Q,pe,C,Se]}class kt extends ot{constructor(l){super(),it(this,l,yt,bt,lt,{map:0},null,[-1,-1])}}function vt(n){let l,t,e,s,d,m,h;function f(o){n[2](o)}let y={maxWidth:"30%"};n[0]!==void 0&&(y.tileset=n[0]),t=new mt({props:y}),Oe.push(()=>Je(t,"tileset",f));function T(o){n[3](o)}let _={};return n[1]!==void 0&&(_.map=n[1]),d=new kt({props:_}),Oe.push(()=>Je(d,"map",T)),{c(){l=v("div"),W(t.$$.fragment),s=O(),W(d.$$.fragment),this.h()},l(o){l=w(o,"DIV",{style:!0});var i=S(l);F(t.$$.fragment,i),s=L(i),F(d.$$.fragment,i),i.forEach(b),this.h()},h(){P(l,"display","flex"),P(l,"gap","16px"),P(l,"justify-content","space-between"),P(l,"width","100%")},m(o,i){de(o,l,i),V(t,l,null),p(l,s),V(d,l,null),h=!0},p(o,[i]){const A={};!e&&i&1&&(e=!0,A.tileset=o[0],je(()=>e=!1)),t.$set(A);const j={};!m&&i&2&&(m=!0,j.map=o[1],je(()=>m=!1)),d.$set(j)},i(o){h||(U(t.$$.fragment,o),U(d.$$.fragment,o),h=!0)},o(o){N(t.$$.fragment,o),N(d.$$.fragment,o),h=!1},d(o){o&&b(l),R(t),R(d)}}}function wt(n,l,t){let e,s;function d(o){o&&o.tileset&&t(0,e=o.tileset)}function m(o){s&&o&&t(1,s.tileset=o,s)}let h;function f(o){clearTimeout(h),h=setTimeout(y,5e3)}function y(){if(!s)return;const o=s.png();o&&localStorage.setItem("tilemap",o.dataURL())}ft(()=>{const o=localStorage.getItem("tilemap");o&&Le.from(o).then(i=>{t(1,s=i)})});function T(o){e=o,t(0,e)}function _(o){s=o,t(1,s)}return n.$$.update=()=>{n.$$.dirty&2&&d(s),n.$$.dirty&1&&m(e),n.$$.dirty&2&&f()},[e,s,T,_]}class Nt extends ot{constructor(l){super(),it(this,l,wt,vt,lt,{})}}export{Nt as component};
