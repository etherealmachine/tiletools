import{s as Xe,r as Le,b as Te,f as Ie}from"../chunks/scheduler.b8ee1aee.js";import{S as Ve,i as We,g as I,m as be,s as S,r as ee,h as P,j as Y,n as ve,f as v,c as F,u as te,y as qe,k as K,z as we,l as $,a as le,x as g,v as ne,A as $e,B as A,o as De,d as O,p as Ne,b as Ae,t as W,w as re,C as Ce,D as Pe}from"../chunks/index.b64d0558.js";import{e as Ye,T as Se}from"../chunks/TilesetEditor.0b7758c7.js";import{I as ue,P as ke,T as Fe}from"../chunks/Tileset.1671e2a1.js";function Be(n,r,t){const e=n.slice();return e[39]=r[t],e[41]=t,e}function He(n){let r,t=n[39].name+"",e,o,s,a,p,u,b,d;const _=[je,Ge],T=[];function D(m,f){return m[39].visible?0:1}return a=D(n),p=T[a]=_[a](n),{c(){r=I("button"),e=be(t),o=S(),s=I("button"),p.c(),this.h()},l(m){r=P(m,"BUTTON",{});var f=Y(r);e=ve(f,t),f.forEach(v),o=F(m),s=P(m,"BUTTON",{});var E=Y(s);p.l(E),E.forEach(v),this.h()},h(){we(r,"selected",n[5]===n[41])},m(m,f){le(m,r,f),g(r,e),le(m,o,f),le(m,s,f),T[a].m(s,null),u=!0,b||(d=[A(r,"click",n[20](n[41])),A(s,"click",n[21](n[41]))],b=!0)},p(m,f){n=m,(!u||f[0]&1)&&t!==(t=n[39].name+"")&&De(e,t),(!u||f[0]&32)&&we(r,"selected",n[5]===n[41]);let E=a;a=D(n),a!==E&&(Ne(),W(T[E],1,1,()=>{T[E]=null}),Ae(),p=T[a],p||(p=T[a]=_[a](n),p.c()),O(p,1),p.m(s,null))},i(m){u||(O(p),u=!0)},o(m){W(p),u=!1},d(m){m&&(v(r),v(o),v(s)),T[a].d(),b=!1,Le(d)}}}function Re(n){let r,t,e,o,s,a,p,u,b;return a=new ue({props:{name:"minus"}}),{c(){r=I("input"),o=S(),s=I("button"),ee(a.$$.fragment),this.h()},l(d){r=P(d,"INPUT",{placeholder:!0}),o=F(d),s=P(d,"BUTTON",{});var _=Y(s);te(a.$$.fragment,_),_.forEach(v),this.h()},h(){K(r,"placeholder",t=n[39].name),r.value=e=n[39].name},m(d,_){le(d,r,_),le(d,o,_),le(d,s,_),ne(a,s,null),p=!0,u||(b=[A(r,"change",n[18](n[41])),A(s,"click",n[19](n[41]))],u=!0)},p(d,_){n=d,(!p||_[0]&1&&t!==(t=n[39].name))&&K(r,"placeholder",t),(!p||_[0]&1&&e!==(e=n[39].name)&&r.value!==e)&&(r.value=e)},i(d){p||(O(a.$$.fragment,d),p=!0)},o(d){W(a.$$.fragment,d),p=!1},d(d){d&&(v(r),v(o),v(s)),re(a),u=!1,Le(b)}}}function Ge(n){let r,t;return r=new ue({props:{name:"eyeOff"}}),{c(){ee(r.$$.fragment)},l(e){te(r.$$.fragment,e)},m(e,o){ne(r,e,o),t=!0},i(e){t||(O(r.$$.fragment,e),t=!0)},o(e){W(r.$$.fragment,e),t=!1},d(e){re(r,e)}}}function je(n){let r,t;return r=new ue({props:{name:"eyeEmpty"}}),{c(){ee(r.$$.fragment)},l(e){te(r.$$.fragment,e)},m(e,o){ne(r,e,o),t=!0},i(e){t||(O(r.$$.fragment,e),t=!0)},o(e){W(r.$$.fragment,e),t=!1},d(e){re(r,e)}}}function Me(n){let r,t,e,o;const s=[Re,He],a=[];function p(u,b){return u[4]?0:1}return t=p(n),e=a[t]=s[t](n),{c(){r=I("div"),e.c()},l(u){r=P(u,"DIV",{});var b=Y(r);e.l(b),b.forEach(v)},m(u,b){le(u,r,b),a[t].m(r,null),o=!0},p(u,b){let d=t;t=p(u),t===d?a[t].p(u,b):(Ne(),W(a[d],1,1,()=>{a[d]=null}),Ae(),e=a[t],e?e.p(u,b):(e=a[t]=s[t](u),e.c()),O(e,1),e.m(r,null))},i(u){o||(O(e),o=!0)},o(u){W(e),o=!1},d(u){u&&v(r),a[t].d()}}}function Ke(n){let r,t,e,o,s,a,p,u,b,d,_,T,D,m,f,E,q="Name",R,G,fe,C,z,de,oe,pe,j,ie,B,he,X,se,Z,_e,ce,ae,J,Q,ge,ye;D=new ue({props:{name:"erase"}}),z=new ue({props:{name:"saveFloppyDisk"}}),Z=new ue({props:{name:"editPencil"}});let x=Ye(n[0]),y=[];for(let i=0;i<x.length;i+=1)y[i]=Me(Be(n,x,i));const l=i=>W(y[i],1,1,()=>{y[i]=null});return J=new ue({props:{name:"plus"}}),{c(){r=I("div"),t=I("div"),e=I("label"),o=I("input"),s=be(`
      Grid`),a=S(),p=I("span"),u=be(n[6]),b=be(", "),d=be(n[7]),_=S(),T=I("button"),ee(D.$$.fragment),m=S(),f=I("div"),E=I("label"),E.textContent=q,R=S(),G=I("input"),fe=S(),C=I("button"),ee(z.$$.fragment),de=S(),oe=I("input"),pe=S(),j=I("div"),ie=I("div"),B=I("canvas"),he=S(),X=I("div"),se=I("button"),ee(Z.$$.fragment),_e=S();for(let i=0;i<y.length;i+=1)y[i].c();ce=S(),ae=I("button"),ee(J.$$.fragment),this.h()},l(i){r=P(i,"DIV",{style:!0});var h=Y(r);t=P(h,"DIV",{style:!0});var c=Y(t);e=P(c,"LABEL",{});var M=Y(e);o=P(M,"INPUT",{type:!0}),s=ve(M,`
      Grid`),M.forEach(v),a=F(c),p=P(c,"SPAN",{});var k=Y(p);u=ve(k,n[6]),b=ve(k,", "),d=ve(k,n[7]),k.forEach(v),_=F(c),T=P(c,"BUTTON",{});var w=Y(T);te(D.$$.fragment,w),w.forEach(v),m=F(c),f=P(c,"DIV",{style:!0});var U=Y(f);E=P(U,"LABEL",{for:!0,"data-svelte-h":!0}),qe(E)!=="svelte-bs9sy6"&&(E.textContent=q),R=F(U),G=P(U,"INPUT",{name:!0,type:!0}),U.forEach(v),fe=F(c),C=P(c,"BUTTON",{});var L=Y(C);te(z.$$.fragment,L),L.forEach(v),de=F(c),oe=P(c,"INPUT",{type:!0,accept:!0}),c.forEach(v),pe=F(h),j=P(h,"DIV",{style:!0});var N=Y(j);ie=P(N,"DIV",{class:!0});var H=Y(ie);B=P(H,"CANVAS",{style:!0,tabindex:!0}),Y(B).forEach(v),H.forEach(v),he=F(N),X=P(N,"DIV",{style:!0});var V=Y(X);se=P(V,"BUTTON",{});var me=Y(se);te(Z.$$.fragment,me),me.forEach(v),_e=F(V);for(let Ee=0;Ee<y.length;Ee+=1)y[Ee].l(V);ce=F(V),ae=P(V,"BUTTON",{});var Ue=Y(ae);te(J.$$.fragment,Ue),Ue.forEach(v),V.forEach(v),N.forEach(v),h.forEach(v),this.h()},h(){K(o,"type","checkbox"),we(T,"active",n[3]),K(E,"for","name"),K(G,"name","name"),K(G,"type","text"),$(f,"display","flex"),$(f,"flex-direction","column"),$(f,"align-items","start"),K(oe,"type","file"),K(oe,"accept","image/png"),$(t,"display","flex"),$(t,"gap","8px"),$(B,"position","absolute"),K(B,"tabindex","1"),K(ie,"class","canvas svelte-16cu0gi"),$(X,"display","flex"),$(X,"flex-direction","column"),$(X,"gap","4px"),$(j,"display","flex"),$(j,"flex-grow","1"),$(r,"display","flex"),$(r,"flex-direction","column"),$(r,"flex-grow","1")},m(i,h){le(i,r,h),g(r,t),g(t,e),g(e,o),o.checked=n[8],g(e,s),g(t,a),g(t,p),g(p,u),g(p,b),g(p,d),g(t,_),g(t,T),ne(D,T,null),g(t,m),g(t,f),g(f,E),g(f,R),g(f,G),$e(G,n[2]),g(t,fe),g(t,C),ne(z,C,null),g(t,de),g(t,oe),g(r,pe),g(r,j),g(j,ie),g(ie,B),n[27](B),g(j,he),g(j,X),g(X,se),ne(Z,se,null),g(X,_e);for(let c=0;c<y.length;c+=1)y[c]&&y[c].m(X,null);g(X,ce),g(X,ae),ne(J,ae,null),Q=!0,ge||(ye=[A(o,"change",n[24]),A(T,"click",n[25]),A(G,"input",n[26]),A(C,"click",n[17]),A(oe,"change",n[16]),A(B,"wheel",n[14]),A(B,"pointerdown",n[10]),A(B,"pointerup",n[11]),A(B,"pointercancel",n[12]),A(B,"pointermove",n[13]),A(B,"keydown",n[15]),A(B,"pointerenter",n[28]),A(B,"pointerleave",n[29]),A(se,"click",n[30]),A(ae,"click",n[22])],ge=!0)},p(i,h){if(h[0]&256&&(o.checked=i[8]),(!Q||h[0]&64)&&De(u,i[6]),(!Q||h[0]&128)&&De(d,i[7]),(!Q||h[0]&8)&&we(T,"active",i[3]),h[0]&4&&G.value!==i[2]&&$e(G,i[2]),h[0]&3932209){x=Ye(i[0]);let c;for(c=0;c<x.length;c+=1){const M=Be(i,x,c);y[c]?(y[c].p(M,h),O(y[c],1)):(y[c]=Me(M),y[c].c(),O(y[c],1),y[c].m(X,ce))}for(Ne(),c=x.length;c<y.length;c+=1)l(c);Ae()}},i(i){if(!Q){O(D.$$.fragment,i),O(z.$$.fragment,i),O(Z.$$.fragment,i);for(let h=0;h<x.length;h+=1)O(y[h]);O(J.$$.fragment,i),Q=!0}},o(i){W(D.$$.fragment,i),W(z.$$.fragment,i),W(Z.$$.fragment,i),y=y.filter(Boolean);for(let h=0;h<y.length;h+=1)W(y[h]);W(J.$$.fragment,i),Q=!1},d(i){i&&v(r),re(D),re(z),n[27](null),re(Z),Ce(y,i),re(J),ge=!1,Le(ye)}}}function ze(n,r,t,e){const o=2*Math.PI/6;n.beginPath();for(var s=0;s<6;s++)n.lineTo(r+e*Math.cos(o*s),t+e*Math.sin(o*s));n.closePath(),n.stroke()}function Ze(n,r,t,e,o){n.beginPath(),n.lineTo(r,t),n.lineTo(r+e,t),n.lineTo(r+e,t+o),n.lineTo(r,t+o),n.closePath(),n.stroke()}function Oe(n,r,t,e,o,s){if(!e.img)return;let[a,p]=e.tileToWorld(r,t);const[u,b]=e.tileToImgCoords(o,s);e.type==="hex"&&(a-=e.radius(),p-=e.hexHeight()+4),n.drawImage(e.img,u,b,e.tilewidth,e.tileheight,a,p,e.tilewidth,e.tileheight)}function Je(n,r,t){let{tileset:e}=r,{layers:o=[{name:"Layer 1",visible:!0,tiles:{}}]}=r,s,a,p=!1,u=!1,b=0,d,_,T,D,m=!0,f=1,E=!1,q=0,R=0;function G(l,i){return[(l-q)/f,(i-R)/f]}function fe(l,i){const[h,c]=G(l,i);return e?e.worldToTile(h,c):[0,0]}function C(){var c,M;const l=s.getContext("2d");if(!l)return;const i=(((c=s.parentElement)==null?void 0:c.scrollWidth)||0)-4,h=(((M=s.parentElement)==null?void 0:M.scrollHeight)||0)-4;if(t(1,s.width=i,s),t(1,s.height=h,s),l.imageSmoothingEnabled=!1,l.resetTransform(),l.clearRect(0,0,i,h),l.setTransform(f,0,0,f,q,R),l.strokeStyle="white",m&&e&&e.tilewidth>0&&e.tileheight>0)if(e.type==="hex"){const k=e.radius(),w=Math.sqrt(3)*k,U=3/2*k;for(let L=0;L<i/w-1;L++)for(let N=0;N<h/U-1;N++){const[H,V]=e.tileToWorld(L,N-Math.floor(L/2));ze(l,H,V,k)}}else for(let k=0;k<i/e.tilewidth-1;k++)for(let w=0;w<h/e.tileheight-1;w++)Ze(l,k*e.tilewidth,w*e.tileheight,e.tilewidth,e.tileheight);if(o.forEach(k=>{k.visible&&Object.entries(k.tiles).sort((w,U)=>{const[L,N]=w[0].split(",").map(me=>parseInt(me)),[H,V]=U[0].split(",").map(me=>parseInt(me));return N===V?L-H:N-V}).forEach(w=>{const[U,L]=w[0].split(",").map(H=>parseInt(H)),N=w[1];Oe(l,U,L,N.tileset,N.tileX,N.tileY)})}),e&&e.loaded()&&d!==void 0&&_!==void 0&&E){let[k,w]=[T||d,D||_],[U,L]=[d,_];k>U&&([k,U]=[U,k]),w>L&&([w,L]=[L,w]);for(let N=k;N<=U;N++)for(let H=w;H<=L;H++){const V=e.randSelectedTile();V&&Oe(l,N,H,e,V[0],V[1])}}}function z(l){t(6,[d,_]=fe(l.offsetX,l.offsetY),d,t(7,_)),[T,D]=[d,_]}function de(l){if(!e||!e.img)return;t(6,[d,_]=fe(l.offsetX,l.offsetY),d,t(7,_));let[i,h]=[T||d,D||_],[c,M]=[d,_];i>c&&([i,c]=[c,i]),h>M&&([h,M]=[M,h]);for(let k=i;k<=c;k++)for(let w=h;w<=M;w++){const U=`${k},${w}`;if(l.ctrlKey||p)delete o[b].tiles[U];else{const L=e.randSelectedTile();L&&t(0,o[b].tiles[U]={tileset:e,tileX:L[0],tileY:L[1]},o)}}requestAnimationFrame(C),[T,D]=[void 0,void 0]}function oe(){[T,D]=[void 0,void 0]}function pe(l){t(6,[d,_]=fe(l.offsetX,l.offsetY),d,t(7,_)),l.buttons===1||l.ctrlKey&&(q+=l.movementX,R+=l.movementY),requestAnimationFrame(C)}function j(l){const i=f;l.deltaY<0?f*=1.1:l.deltaY>0&&(f*=.9),f=Math.min(Math.max(.25,f),8),q=-f*(l.offsetX-q)/i+l.offsetX,R=-f*(l.offsetY-R)/i+l.offsetY,requestAnimationFrame(C)}function ie(l){if(e&&E){switch(l.key){case"ArrowLeft":q+=f*e.offsetWidth(),l.preventDefault();break;case"ArrowRight":q-=f*e.offsetWidth(),l.preventDefault();break;case"ArrowUp":R+=f*e.offsetHeight(),l.preventDefault();break;case"ArrowDown":R-=f*e.offsetHeight(),l.preventDefault();break}requestAnimationFrame(C)}}function B(l){if(l.target===null)return;const i=l.target.files;if(i===null)return;const h=i[0];ke.fromFile(h).then(c=>{const M=ke.fromDataURL(c.metadata.tileset);t(23,e=new Fe(M.metadata)),t(23,e.img=document.createElement("img"),e),t(23,e.img.src=M.dataURL(),e),t(0,o=c.metadata.layers),o.forEach(k=>{Object.values(k.tiles).forEach(w=>{e&&(w.tileset=e)})}),t(2,a=c.metadata.name)})}function he(){const l={layers:o};if(e&&e.img){const h=new ke(e.name,e.metadata(),e.img);h.metadata.name=e.name,l.tileset=h.dataURL(),l.name=a}new ke(a,l,s).download()}function X(l){return i=>{i.currentTarget!==null&&t(0,o[l].name=i.currentTarget.value,o)}}function se(l){return()=>{o.splice(l,1),t(0,o),requestAnimationFrame(C)}}function Z(l){return()=>{t(5,b=l)}}function _e(l){return()=>{t(0,o[l].visible=!o[l].visible,o),t(0,o),requestAnimationFrame(C)}}function ce(){o.push({name:`Layer ${o.length+1}`,visible:!0,tiles:{}}),t(0,o)}function ae(){m=this.checked,t(8,m)}const J=()=>{t(3,p=!p)};function Q(){a=this.value,t(2,a)}function ge(l){Te[l?"unshift":"push"](()=>{s=l,t(1,s)})}const ye=()=>{s.focus(),t(9,E=!0)},x=()=>{t(9,E=!1)},y=()=>{t(4,u=!u)};return n.$$set=l=>{"tileset"in l&&t(23,e=l.tileset),"layers"in l&&t(0,o=l.layers)},[o,s,a,p,u,b,d,_,m,E,z,de,oe,pe,j,ie,B,he,X,se,Z,_e,ce,e,ae,J,Q,ge,ye,x,y]}class Qe extends Ve{constructor(r){super(),We(this,r,Je,Ke,Xe,{tileset:23,layers:0},null,[-1,-1])}}function xe(n){let r,t,e,o,s,a,p,u;function b(m){n[2](m)}let d={maxWidth:"30%"};n[0]!==void 0&&(d.tileset=n[0]),t=new Se({props:d}),Te.push(()=>Pe(t,"tileset",b));function _(m){n[3](m)}function T(m){n[4](m)}let D={};return n[0]!==void 0&&(D.tileset=n[0]),n[1]!==void 0&&(D.layers=n[1]),s=new Qe({props:D}),Te.push(()=>Pe(s,"tileset",_)),Te.push(()=>Pe(s,"layers",T)),{c(){r=I("div"),ee(t.$$.fragment),o=S(),ee(s.$$.fragment),this.h()},l(m){r=P(m,"DIV",{style:!0});var f=Y(r);te(t.$$.fragment,f),o=F(f),te(s.$$.fragment,f),f.forEach(v),this.h()},h(){$(r,"display","flex"),$(r,"gap","16px"),$(r,"justify-content","space-between"),$(r,"width","100%")},m(m,f){le(m,r,f),ne(t,r,null),g(r,o),ne(s,r,null),u=!0},p(m,[f]){const E={};!e&&f&1&&(e=!0,E.tileset=m[0],Ie(()=>e=!1)),t.$set(E);const q={};!a&&f&1&&(a=!0,q.tileset=m[0],Ie(()=>a=!1)),!p&&f&2&&(p=!0,q.layers=m[1],Ie(()=>p=!1)),s.$set(q)},i(m){u||(O(t.$$.fragment,m),O(s.$$.fragment,m),u=!0)},o(m){W(t.$$.fragment,m),W(s.$$.fragment,m),u=!1},d(m){m&&v(r),re(t),re(s)}}}function et(n,r,t){let e,o;function s(u){e=u,t(0,e)}function a(u){e=u,t(0,e)}function p(u){o=u,t(1,o)}return[e,o,s,a,p]}class ot extends Ve{constructor(r){super(),We(this,r,et,xe,Xe,{})}}export{ot as component};
