import{s as At,j as Bt,r as Lt,n as Pt,b as Tt}from"./scheduler.b8ee1aee.js";import{S as Ut,i as Vt,g as r,s as v,r as ke,h as s,j as w,c as _,y as me,f as g,u as Ne,k as f,l as o,A as x,z as Ae,a as Nt,x as n,E as Ct,v as Be,B as c,F as ye,d as Le,t as Pe,w as Ue,C as Wt,G as Ot}from"./index.b64d0558.js";import{I as Ve,T as It,P as Yt}from"./Tileset.1671e2a1.js";function xt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Dt(t,u,e){const l=t.slice();return l[9]=u[e],l}function St(t){let u;return{c(){u=r("button"),this.h()},l(e){u=s(e,"BUTTON",{class:!0}),w(u).forEach(g),this.h()},h(){f(u,"class","palette"),o(u,"background-color",t[9])},m(e,l){Nt(e,u,l)},p:Pt,d(e){e&&g(u)}}}function Ft(t){let u,e,l,oe,U,E,T="Name",de,V,W,C,B,Z="Width",pe,D,X,p,S,re="Height",We,P,he,j,te,He="Margin",Oe,O,Ye,G,se,Re="Spacing",Fe,Y,Me,K,ue,je="Type",Xe,q,J,Ge="Square",Q,Ke="Hex",qe,I,ne,fe,i,b,k,$,F,d,N,y,M,we,ce,Ee,nt,ge,Te,ze,lt,ve,le,it,xe,H,at,R,ie,Ce,dt="Tags",ot,ee,rt,_e,st,ae,be,ut,pt;fe=new Ve({props:{name:"openSelectHandGesture"}}),k=new Ve({props:{name:"editPencil"}}),d=new Ve({props:{name:"erase"}}),M=new Ve({props:{name:"copy"}}),Ee=new Ve({props:{name:"pasteClipboard"}}),Te=new Ve({props:{name:"saveFloppyDisk"}});let De=xt(t[10]),A=[];for(let a=0;a<De.length;a+=1)A[a]=St(Dt(t,De,a));return{c(){u=r("div"),e=r("div"),l=r("input"),oe=v(),U=r("div"),E=r("label"),E.textContent=T,de=v(),V=r("input"),W=v(),C=r("div"),B=r("label"),B.textContent=Z,pe=v(),D=r("input"),X=v(),p=r("div"),S=r("label"),S.textContent=re,We=v(),P=r("input"),he=v(),j=r("div"),te=r("label"),te.textContent=He,Oe=v(),O=r("input"),Ye=v(),G=r("div"),se=r("label"),se.textContent=Re,Fe=v(),Y=r("input"),Me=v(),K=r("div"),ue=r("label"),ue.textContent=je,Xe=v(),q=r("select"),J=r("option"),J.textContent=Ge,Q=r("option"),Q.textContent=Ke,qe=v(),I=r("div"),ne=r("button"),ke(fe.$$.fragment),i=v(),b=r("button"),ke(k.$$.fragment),$=v(),F=r("button"),ke(d.$$.fragment),N=v(),y=r("button"),ke(M.$$.fragment),we=v(),ce=r("button"),ke(Ee.$$.fragment),nt=v(),ge=r("button"),ke(Te.$$.fragment),lt=v(),ve=r("div"),le=r("input"),it=v(),xe=r("div"),H=r("canvas"),at=v(),R=r("div"),ie=r("div"),Ce=r("label"),Ce.textContent=dt,ot=v(),ee=r("input"),rt=v(),_e=r("input"),st=v(),ae=r("div");for(let a=0;a<A.length;a+=1)A[a].c();this.h()},l(a){u=s(a,"DIV",{style:!0});var h=w(u);e=s(h,"DIV",{style:!0});var m=w(e);l=s(m,"INPUT",{type:!0,accept:!0}),oe=_(m),U=s(m,"DIV",{style:!0});var Ie=w(U);E=s(Ie,"LABEL",{for:!0,"data-svelte-h":!0}),me(E)!=="svelte-bs9sy6"&&(E.textContent=T),de=_(Ie),V=s(Ie,"INPUT",{name:!0,type:!0}),Ie.forEach(g),W=_(m),C=s(m,"DIV",{style:!0});var Ze=w(C);B=s(Ze,"LABEL",{for:!0,"data-svelte-h":!0}),me(B)!=="svelte-17m14b6"&&(B.textContent=Z),pe=_(Ze),D=s(Ze,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),Ze.forEach(g),X=_(m),p=s(m,"DIV",{style:!0});var Je=w(p);S=s(Je,"LABEL",{for:!0,"data-svelte-h":!0}),me(S)!=="svelte-1bbixbe"&&(S.textContent=re),We=_(Je),P=s(Je,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),Je.forEach(g),he=_(m),j=s(m,"DIV",{style:!0});var Qe=w(j);te=s(Qe,"LABEL",{for:!0,"data-svelte-h":!0}),me(te)!=="svelte-h0yole"&&(te.textContent=He),Oe=_(Qe),O=s(Qe,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),Qe.forEach(g),Ye=_(m),G=s(m,"DIV",{style:!0});var $e=w(G);se=s($e,"LABEL",{for:!0,"data-svelte-h":!0}),me(se)!=="svelte-13gacwk"&&(se.textContent=Re),Fe=_($e),Y=s($e,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),$e.forEach(g),Me=_(m),K=s(m,"DIV",{style:!0});var et=w(K);ue=s(et,"LABEL",{for:!0,"data-svelte-h":!0}),me(ue)!=="svelte-15475si"&&(ue.textContent=je),Xe=_(et),q=s(et,"SELECT",{name:!0});var ft=w(q);J=s(ft,"OPTION",{"data-svelte-h":!0}),me(J)!=="svelte-bkgndu"&&(J.textContent=Ge),Q=s(ft,"OPTION",{"data-svelte-h":!0}),me(Q)!=="svelte-77owgo"&&(Q.textContent=Ke),ft.forEach(g),et.forEach(g),qe=_(m),I=s(m,"DIV",{style:!0});var z=w(I);ne=s(z,"BUTTON",{});var ht=w(ne);Ne(fe.$$.fragment,ht),ht.forEach(g),i=_(z),b=s(z,"BUTTON",{});var ct=w(b);Ne(k.$$.fragment,ct),ct.forEach(g),$=_(z),F=s(z,"BUTTON",{});var gt=w(F);Ne(d.$$.fragment,gt),gt.forEach(g),N=_(z),y=s(z,"BUTTON",{});var vt=w(y);Ne(M.$$.fragment,vt),vt.forEach(g),we=_(z),ce=s(z,"BUTTON",{});var _t=w(ce);Ne(Ee.$$.fragment,_t),_t.forEach(g),nt=_(z),ge=s(z,"BUTTON",{});var bt=w(ge);Ne(Te.$$.fragment,bt),bt.forEach(g),z.forEach(g),m.forEach(g),lt=_(h),ve=s(h,"DIV",{style:!0});var yt=w(ve);le=s(yt,"INPUT",{name:!0,type:!0,placeholder:!0}),yt.forEach(g),it=_(h),xe=s(h,"DIV",{class:!0});var wt=w(xe);H=s(wt,"CANVAS",{style:!0}),w(H).forEach(g),wt.forEach(g),at=_(h),R=s(h,"DIV",{style:!0});var Se=w(R);ie=s(Se,"DIV",{style:!0});var tt=w(ie);Ce=s(tt,"LABEL",{for:!0,"data-svelte-h":!0}),me(Ce)!=="svelte-e2ajgy"&&(Ce.textContent=dt),ot=_(tt),ee=s(tt,"INPUT",{name:!0,type:!0}),tt.forEach(g),rt=_(Se),_e=s(Se,"INPUT",{type:!0,name:!0}),st=_(Se),ae=s(Se,"DIV",{style:!0});var Et=w(ae);for(let mt=0;mt<A.length;mt+=1)A[mt].l(Et);Et.forEach(g),Se.forEach(g),h.forEach(g),this.h()},h(){f(l,"type","file"),f(l,"accept","image/png"),f(E,"for","name"),f(V,"name","name"),f(V,"type","text"),o(U,"display","flex"),o(U,"flex-direction","column"),o(U,"align-items","start"),f(B,"for","width"),f(D,"name","width"),f(D,"type","number"),f(D,"min","1"),f(D,"max","64"),o(D,"max-width","4em"),o(C,"display","flex"),o(C,"flex-direction","column"),o(C,"align-items","start"),f(S,"for","height"),f(P,"name","height"),f(P,"type","number"),f(P,"min","1"),f(P,"max","64"),o(P,"max-width","4em"),o(p,"display","flex"),o(p,"flex-direction","column"),o(p,"align-items","start"),f(te,"for","margin"),f(O,"name","margin"),f(O,"type","number"),f(O,"min","1"),f(O,"max","64"),o(O,"max-width","4em"),o(j,"display","flex"),o(j,"flex-direction","column"),o(j,"align-items","start"),f(se,"for","spacing"),f(Y,"name","spacing"),f(Y,"type","number"),f(Y,"min","1"),f(Y,"max","64"),o(Y,"max-width","4em"),o(G,"display","flex"),o(G,"flex-direction","column"),o(G,"align-items","start"),f(ue,"for","type"),J.__value="square",x(J,J.__value),Q.__value="hex",x(Q,Q.__value),f(q,"name","type"),t[0].type===void 0&&Bt(()=>t[27].call(q)),o(K,"display","flex"),o(K,"flex-direction","column"),o(K,"align-items","start"),Ae(ne,"active",t[8]===L.Select),Ae(b,"active",t[8]===L.Edit),Ae(F,"active",t[8]===L.Erase),ge.disabled=ze=!t[0].img||!t[0].img.src,o(I,"margin-left","auto"),o(I,"display","flex"),o(I,"gap","8px"),o(e,"display","flex"),o(e,"gap","8px"),o(e,"align-items","end"),o(e,"flex-wrap","wrap"),f(le,"name","filter"),f(le,"type","text"),f(le,"placeholder","Filter"),o(ve,"display","flex"),o(ve,"gap","8px"),o(ve,"align-items","end"),o(H,"position","absolute"),f(xe,"class","canvas svelte-16cu0gi"),f(Ce,"for","tags"),f(ee,"name","tags"),f(ee,"type","text"),o(ie,"display","flex"),o(ie,"flex-direction","column"),o(ie,"align-items","start"),f(_e,"type","color"),f(_e,"name","color"),o(ae,"display","flex"),o(ae,"flex-direction","row"),o(ae,"flex-wrap","wrap"),o(ae,"gap","12px"),o(R,"display","flex"),o(R,"flex-direction","row"),o(R,"gap","8px"),o(R,"align-items","start"),o(u,"display","flex"),o(u,"flex-direction","column"),o(u,"gap","8px"),o(u,"flex-grow","1"),o(u,"max-width",t[1])},m(a,h){Nt(a,u,h),n(u,e),n(e,l),n(e,oe),n(e,U),n(U,E),n(U,de),n(U,V),x(V,t[0].name),n(e,W),n(e,C),n(C,B),n(C,pe),n(C,D),x(D,t[0].tilewidth),n(e,X),n(e,p),n(p,S),n(p,We),n(p,P),x(P,t[0].tileheight),n(e,he),n(e,j),n(j,te),n(j,Oe),n(j,O),x(O,t[0].margin),n(e,Ye),n(e,G),n(G,se),n(G,Fe),n(G,Y),x(Y,t[0].spacing),n(e,Me),n(e,K),n(K,ue),n(K,Xe),n(K,q),n(q,J),n(q,Q),Ct(q,t[0].type,!0),n(e,qe),n(e,I),n(I,ne),Be(fe,ne,null),n(I,i),n(I,b),Be(k,b,null),n(I,$),n(I,F),Be(d,F,null),n(I,N),n(I,y),Be(M,y,null),n(I,we),n(I,ce),Be(Ee,ce,null),n(I,nt),n(I,ge),Be(Te,ge,null),n(u,lt),n(u,ve),n(ve,le),x(le,t[2]),n(u,it),n(u,xe),n(xe,H),t[32](H),n(u,at),n(u,R),n(R,ie),n(ie,Ce),n(ie,ot),n(ie,ee),x(ee,t[7]),t[38](ee),n(R,rt),n(R,_e),x(_e,t[9]),n(R,st),n(R,ae);for(let m=0;m<A.length;m+=1)A[m]&&A[m].m(ae,null);be=!0,ut||(pt=[c(window,"keydown",t[16]),c(l,"change",t[14]),c(V,"input",t[22]),c(D,"input",t[23]),c(P,"input",t[24]),c(O,"input",t[25]),c(Y,"input",t[26]),c(q,"change",t[27]),c(ne,"click",t[28]),c(b,"click",t[29]),c(F,"click",t[30]),c(y,"click",Xt),c(ce,"click",qt),c(ge,"click",t[15]),c(le,"input",t[31]),c(H,"wheel",t[11]),c(H,"click",t[12]),c(H,"pointermove",t[13]),c(H,"pointerdown",t[33]),c(H,"pointerup",t[34]),c(H,"pointerenter",t[35]),c(H,"pointerleave",t[36]),c(ee,"change",Mt),c(ee,"input",t[37]),c(_e,"input",t[39])],ut=!0)},p(a,h){if(h[0]&1&&V.value!==a[0].name&&x(V,a[0].name),h[0]&1&&ye(D.value)!==a[0].tilewidth&&x(D,a[0].tilewidth),h[0]&1&&ye(P.value)!==a[0].tileheight&&x(P,a[0].tileheight),h[0]&1&&ye(O.value)!==a[0].margin&&x(O,a[0].margin),h[0]&1&&ye(Y.value)!==a[0].spacing&&x(Y,a[0].spacing),h[0]&1&&Ct(q,a[0].type),(!be||h[0]&256)&&Ae(ne,"active",a[8]===L.Select),(!be||h[0]&256)&&Ae(b,"active",a[8]===L.Edit),(!be||h[0]&256)&&Ae(F,"active",a[8]===L.Erase),(!be||h[0]&1&&ze!==(ze=!a[0].img||!a[0].img.src))&&(ge.disabled=ze),h[0]&4&&le.value!==a[2]&&x(le,a[2]),h[0]&128&&ee.value!==a[7]&&x(ee,a[7]),h[0]&512&&x(_e,a[9]),h[0]&1024){De=xt(a[10]);let m;for(m=0;m<De.length;m+=1){const Ie=Dt(a,De,m);A[m]?A[m].p(Ie,h):(A[m]=St(Ie),A[m].c(),A[m].m(ae,null))}for(;m<A.length;m+=1)A[m].d(1);A.length=De.length}h[0]&2&&o(u,"max-width",a[1])},i(a){be||(Le(fe.$$.fragment,a),Le(k.$$.fragment,a),Le(d.$$.fragment,a),Le(M.$$.fragment,a),Le(Ee.$$.fragment,a),Le(Te.$$.fragment,a),be=!0)},o(a){Pe(fe.$$.fragment,a),Pe(k.$$.fragment,a),Pe(d.$$.fragment,a),Pe(M.$$.fragment,a),Pe(Ee.$$.fragment,a),Pe(Te.$$.fragment,a),be=!1},d(a){a&&g(u),Ue(fe),Ue(k),Ue(d),Ue(M),Ue(Ee),Ue(Te),t[32](null),t[38](null),Wt(A,a),ut=!1,Lt(pt)}}}var L=(t=>(t[t.Select=0]="Select",t[t.Edit=1]="Edit",t[t.Erase=2]="Erase",t))(L||{});function kt(t,u,e,l,oe){t.beginPath(),t.lineTo(u,e),t.lineTo(u+l,e),t.lineTo(u+l,e+oe),t.lineTo(u,e+oe),t.closePath(),t.stroke()}function Mt(){}function Xt(){}function qt(){}function Ht(t,u,e){let{tileset:l=new It({})}=u,{maxWidth:oe=void 0}=u,U,E,T=2,de=!1,V=!1,W=0,C=0,B,Z,pe,D,X=L.Select,p,S,re="#ffffff",We=new Set;function P(i,b){return[(i-W)/T,(b-C)/T]}function he(){var $,F;if(!E)return;const i=E.getContext("2d");if(!i)return;const b=((($=E.parentElement)==null?void 0:$.scrollWidth)||0)-4,k=(((F=E.parentElement)==null?void 0:F.scrollHeight)||0)-4;if(e(4,E.width=b,E),e(4,E.height=k,E),i.imageSmoothingEnabled=!1,i.resetTransform(),i.clearRect(0,0,b,k),i.setTransform(T,0,0,T,W,C),S)i.drawImage(S,0,0,S.width,S.height);else if(l&&l.loaded()&&p)createImageBitmap(p).then(d=>{S=d}),requestAnimationFrame(he);else if(l&&l.img&&l.loaded()&&!p){const d=document.createElement("canvas");d.width=l.img.width,d.height=l.img.height;const N=d.getContext("2d");if(!N)return;N.resetTransform(),N.drawImage(l.img,0,0,d.width,d.height),p=N.getImageData(0,0,d.width,d.height),createImageBitmap(p).then(y=>{S=y}),requestAnimationFrame(he)}if(!(B===void 0||Z===void 0)){if(p&&(X===L.Edit||X===L.Erase)&&V){const d=Math.floor(B),N=Math.floor(Z);if(l.inSelection(Math.floor(B),Math.floor(Z))){const y=(N*p.width+d)*4;X===L.Edit?(p.data[y+0]=parseInt(re.slice(1,3),16),p.data[y+1]=parseInt(re.slice(3,5),16),p.data[y+2]=parseInt(re.slice(5,7),16),p.data[y+3]=255):(p.data[y+0]=0,p.data[y+1]=0,p.data[y+2]=0,p.data[y+3]=0),createImageBitmap(p).then(M=>{S=M})}}if(i.strokeStyle="white",i.lineWidth=1,X===L.Select){const[d,N]=l.imgCoordsToTile(B,Z),[y,M]=l.tileToImgCoords(d,N),[we,ce]=l.tileToImgCoords(d+1,N+1);d!=null&&N!==void 0&&kt(i,y,M,we-y,ce-M)}l.selectedTiles.forEach(d=>{const[N,y]=l.tileToImgCoords(d[0],d[1]),[M,we]=l.tileToImgCoords(d[0]+1,d[1]+1);kt(i,N,y,M-N,we-y)})}}function j(i){const b=T;i.deltaY<0?e(17,T*=1.1):i.deltaY>0&&e(17,T*=.9),e(17,T=Math.min(Math.max(.05,T),16)),e(18,W=-T*(i.offsetX-W)/b+i.offsetX),e(19,C=-T*(i.offsetY-C)/b+i.offsetY)}function te(i){if(X!==L.Select)return;const[b,k]=P(i.offsetX,i.offsetY);if(!l.img||b<0||b>=l.img.width||k<0||k>=l.img.height)return;const[$,F]=l.imgCoordsToTile(b,k);i.shiftKey?l.addSelectedTile($,F):l.setSelectedTile($,F)}function He(i){i.buttons===1?te(i):i.ctrlKey&&(e(18,W+=i.movementX),e(19,C+=i.movementY)),e(20,[B,Z]=P(i.offsetX,i.offsetY),B,e(21,Z))}function Oe(i){if(i.target===null)return;const b=i.target.files;if(b===null)return;const k=b[0];k&&It.loadFromFile(k).then($=>{e(0,l=$),e(7,pe=""),e(18,W=0),e(19,C=0),e(17,T=2)})}function O(){S&&new Yt(l.name,l.metadata(),S).download()}function Ye(...i){l&&l.loaded()&&requestAnimationFrame(he)}function G(i){if(de){switch(i.key){case"ArrowLeft":e(18,W+=T*l.offsetWidth()),i.preventDefault();break;case"ArrowRight":e(18,W-=T*l.offsetWidth()),i.preventDefault();break;case"ArrowUp":e(19,C+=T*l.offsetHeight()),i.preventDefault();break;case"ArrowDown":e(19,C-=T*l.offsetHeight()),i.preventDefault();break}requestAnimationFrame(he)}}function se(){l.name=this.value,e(0,l)}function Re(){l.tilewidth=ye(this.value),e(0,l)}function Fe(){l.tileheight=ye(this.value),e(0,l)}function Y(){l.margin=ye(this.value),e(0,l)}function Me(){l.spacing=ye(this.value),e(0,l)}function K(){l.type=Ot(this),e(0,l)}const ue=()=>{e(8,X=L.Select)},je=()=>{e(8,X=L.Edit)},Xe=()=>{e(8,X=L.Erase)};function q(){D=this.value,e(2,D)}function J(i){Tt[i?"unshift":"push"](()=>{E=i,e(4,E)})}const Ge=()=>{e(6,V=!0)},Q=()=>{e(6,V=!1)},Ke=()=>{E&&E.focus(),e(5,de=!0)},qe=()=>{e(5,de=!1)};function I(){pe=this.value,e(7,pe)}function ne(i){Tt[i?"unshift":"push"](()=>{U=i,e(3,U)})}function fe(){re=this.value,e(9,re)}return t.$$set=i=>{"tileset"in i&&e(0,l=i.tileset),"maxWidth"in i&&e(1,oe=i.maxWidth)},t.$$.update=()=>{t.$$.dirty[0]&4063237&&Ye(l,T,W,C,D,B,Z)},[l,oe,D,U,E,de,V,pe,X,re,We,j,te,He,Oe,O,G,T,W,C,B,Z,se,Re,Fe,Y,Me,K,ue,je,Xe,q,J,Ge,Q,Ke,qe,I,ne,fe]}class Kt extends Ut{constructor(u){super(),Vt(this,u,Ht,Ft,At,{tileset:0,maxWidth:1},null,[-1,-1])}}export{Kt as T,xt as e};
