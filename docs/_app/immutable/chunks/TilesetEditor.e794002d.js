import{s as Sn,j as Mn,r as Nn,b as Tn}from"./scheduler.b8ee1aee.js";import{S as Un,i as Bn,g as o,s as v,r as z,h as a,j as k,c as T,y as Ne,f as y,u as q,k as d,l as i,A,z as He,a as Dn,x as r,E as yn,v as G,B as m,F as ce,d as Z,t as J,w as Q,C as Pn,G as An}from"./index.b64d0558.js";import{I as x}from"./Icon.101b12af.js";import{T as kn,a as wn,d as On}from"./Tileset.25979cb8.js";const Ln=!0;function En(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}const Vn=Ln;function In(l,u,n){const e=l.slice();return e[6]=u[n],e}function Cn(l){let u,n,e;return{c(){u=o("button"),this.h()},l(K){u=a(K,"BUTTON",{class:!0}),k(u).forEach(y),this.h()},h(){d(u,"class","palette"),i(u,"background-color",l[6])},m(K,p){Dn(K,u,p),n||(e=m(u,"click",l[12]),n=!0)},p(K,p){p[0]&1&&i(u,"background-color",K[6])},d(K){K&&y(u),n=!1,e()}}}function Wn(l){let u,n,e,K,p,c,ve="Name",Re,M,L,C,N,Ue="Width",Te,V,ye,W,E,$="Height",oe,Y,Fe,ne,ke,vt="Margin",at,F,ut,le,we,Tt="Spacing",ft,U,dt,j,Ee,yt="Type",ct,ee,ae,kt="Square",ue,wt="Hex",ht,g,he,Ie,pt,se,Ce,nt,mt,re,De,lt,gt,ie,Se,st,bt,pe,Me,rt,t,h,w,O,H,D,S,fe,P,je,ze,_t,Be,qe,Et,Yt,Pe,Ge,It,Xt,Ae,Ze,Ct,Kt,Oe,Je,Dt,Ht,Le,Qe,St,Rt,Ve,xe,Mt,Ft,We,$e,Nt,jt,Ye,me,zt,it,te,qt,R,ge,et,tn="Tags",Gt,de,Zt,Xe,Ut,Jt,be,Qt,_e,B,xt,nn;Ie=new x({props:{name:"openSelectHandGesture"}}),Ce=new x({props:{name:"editPencil"}}),De=new x({props:{name:"erase"}}),Se=new x({props:{name:"drag"}}),Me=new x({props:{name:"flipHoriz"}}),w=new x({props:{name:"flipVert"}}),S=new x({props:{name:"cropRotateTl"}}),qe=new x({props:{name:"undo"}}),Ge=new x({props:{name:"redo"}}),Ze=new x({props:{name:"deleteCircle"}}),Je=new x({props:{name:"cut"}}),Qe=new x({props:{name:"copy"}}),xe=new x({props:{name:"pasteClipboard"}}),$e=new x({props:{name:"saveFloppyDisk"}});let ot=En(l[0].palette()),X=[];for(let s=0;s<ot.length;s+=1)X[s]=Cn(In(l,ot,s));return{c(){u=o("div"),n=o("div"),e=o("input"),K=v(),p=o("div"),c=o("label"),c.textContent=ve,Re=v(),M=o("input"),L=v(),C=o("div"),N=o("label"),N.textContent=Ue,Te=v(),V=o("input"),ye=v(),W=o("div"),E=o("label"),E.textContent=$,oe=v(),Y=o("input"),Fe=v(),ne=o("div"),ke=o("label"),ke.textContent=vt,at=v(),F=o("input"),ut=v(),le=o("div"),we=o("label"),we.textContent=Tt,ft=v(),U=o("input"),dt=v(),j=o("div"),Ee=o("label"),Ee.textContent=yt,ct=v(),ee=o("select"),ae=o("option"),ae.textContent=kt,ue=o("option"),ue.textContent=wt,ht=v(),g=o("div"),he=o("button"),z(Ie.$$.fragment),pt=v(),se=o("button"),z(Ce.$$.fragment),mt=v(),re=o("button"),z(De.$$.fragment),gt=v(),ie=o("button"),z(Se.$$.fragment),bt=v(),pe=o("button"),z(Me.$$.fragment),t=v(),h=o("button"),z(w.$$.fragment),H=v(),D=o("button"),z(S.$$.fragment),fe=v(),P=o("input"),_t=v(),Be=o("button"),z(qe.$$.fragment),Yt=v(),Pe=o("button"),z(Ge.$$.fragment),Xt=v(),Ae=o("button"),z(Ze.$$.fragment),Kt=v(),Oe=o("button"),z(Je.$$.fragment),Ht=v(),Le=o("button"),z(Qe.$$.fragment),Rt=v(),Ve=o("button"),z(xe.$$.fragment),Ft=v(),We=o("button"),z($e.$$.fragment),jt=v(),Ye=o("div"),me=o("input"),zt=v(),it=o("div"),te=o("canvas"),qt=v(),R=o("div"),ge=o("div"),et=o("label"),et.textContent=tn,Gt=v(),de=o("input"),Zt=v(),Xe=o("input"),Jt=v(),be=o("input"),Qt=v(),_e=o("div");for(let s=0;s<X.length;s+=1)X[s].c();this.h()},l(s){u=a(s,"DIV",{style:!0});var f=k(u);n=a(f,"DIV",{style:!0});var _=k(n);e=a(_,"INPUT",{type:!0,accept:!0}),K=T(_),p=a(_,"DIV",{style:!0});var tt=k(p);c=a(tt,"LABEL",{for:!0,"data-svelte-h":!0}),Ne(c)!=="svelte-bs9sy6"&&(c.textContent=ve),Re=T(tt),M=a(tt,"INPUT",{name:!0,type:!0}),tt.forEach(y),L=T(_),C=a(_,"DIV",{style:!0});var Bt=k(C);N=a(Bt,"LABEL",{for:!0,"data-svelte-h":!0}),Ne(N)!=="svelte-17m14b6"&&(N.textContent=Ue),Te=T(Bt),V=a(Bt,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),Bt.forEach(y),ye=T(_),W=a(_,"DIV",{style:!0});var Pt=k(W);E=a(Pt,"LABEL",{for:!0,"data-svelte-h":!0}),Ne(E)!=="svelte-1bbixbe"&&(E.textContent=$),oe=T(Pt),Y=a(Pt,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),Pt.forEach(y),Fe=T(_),ne=a(_,"DIV",{style:!0});var At=k(ne);ke=a(At,"LABEL",{for:!0,"data-svelte-h":!0}),Ne(ke)!=="svelte-h0yole"&&(ke.textContent=vt),at=T(At),F=a(At,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),At.forEach(y),ut=T(_),le=a(_,"DIV",{style:!0});var Ot=k(le);we=a(Ot,"LABEL",{for:!0,"data-svelte-h":!0}),Ne(we)!=="svelte-13gacwk"&&(we.textContent=Tt),ft=T(Ot),U=a(Ot,"INPUT",{name:!0,type:!0,min:!0,max:!0,style:!0}),Ot.forEach(y),dt=T(_),j=a(_,"DIV",{style:!0});var Lt=k(j);Ee=a(Lt,"LABEL",{for:!0,"data-svelte-h":!0}),Ne(Ee)!=="svelte-15475si"&&(Ee.textContent=yt),ct=T(Lt),ee=a(Lt,"SELECT",{name:!0});var $t=k(ee);ae=a($t,"OPTION",{"data-svelte-h":!0}),Ne(ae)!=="svelte-bkgndu"&&(ae.textContent=kt),ue=a($t,"OPTION",{"data-svelte-h":!0}),Ne(ue)!=="svelte-77owgo"&&(ue.textContent=wt),$t.forEach(y),Lt.forEach(y),ht=T(_),g=a(_,"DIV",{style:!0});var I=k(g);he=a(I,"BUTTON",{});var ln=k(he);q(Ie.$$.fragment,ln),ln.forEach(y),pt=T(I),se=a(I,"BUTTON",{});var sn=k(se);q(Ce.$$.fragment,sn),sn.forEach(y),mt=T(I),re=a(I,"BUTTON",{});var rn=k(re);q(De.$$.fragment,rn),rn.forEach(y),gt=T(I),ie=a(I,"BUTTON",{});var on=k(ie);q(Se.$$.fragment,on),on.forEach(y),bt=T(I),pe=a(I,"BUTTON",{});var an=k(pe);q(Me.$$.fragment,an),an.forEach(y),t=T(I),h=a(I,"BUTTON",{});var un=k(h);q(w.$$.fragment,un),un.forEach(y),H=T(I),D=a(I,"BUTTON",{});var Vt=k(D);q(S.$$.fragment,Vt),fe=T(Vt),P=a(Vt,"INPUT",{type:!0,min:!0,max:!0}),Vt.forEach(y),_t=T(I),Be=a(I,"BUTTON",{});var fn=k(Be);q(qe.$$.fragment,fn),fn.forEach(y),Yt=T(I),Pe=a(I,"BUTTON",{});var dn=k(Pe);q(Ge.$$.fragment,dn),dn.forEach(y),Xt=T(I),Ae=a(I,"BUTTON",{});var cn=k(Ae);q(Ze.$$.fragment,cn),cn.forEach(y),Kt=T(I),Oe=a(I,"BUTTON",{});var hn=k(Oe);q(Je.$$.fragment,hn),hn.forEach(y),Ht=T(I),Le=a(I,"BUTTON",{});var pn=k(Le);q(Qe.$$.fragment,pn),pn.forEach(y),Rt=T(I),Ve=a(I,"BUTTON",{});var mn=k(Ve);q(xe.$$.fragment,mn),mn.forEach(y),Ft=T(I),We=a(I,"BUTTON",{});var gn=k(We);q($e.$$.fragment,gn),gn.forEach(y),I.forEach(y),_.forEach(y),jt=T(f),Ye=a(f,"DIV",{style:!0});var bn=k(Ye);me=a(bn,"INPUT",{name:!0,type:!0,placeholder:!0}),bn.forEach(y),zt=T(f),it=a(f,"DIV",{class:!0});var _n=k(it);te=a(_n,"CANVAS",{style:!0}),k(te).forEach(y),_n.forEach(y),qt=T(f),R=a(f,"DIV",{style:!0});var Ke=k(R);ge=a(Ke,"DIV",{style:!0});var Wt=k(ge);et=a(Wt,"LABEL",{for:!0,"data-svelte-h":!0}),Ne(et)!=="svelte-e2ajgy"&&(et.textContent=tn),Gt=T(Wt),de=a(Wt,"INPUT",{name:!0,type:!0}),Wt.forEach(y),Zt=T(Ke),Xe=a(Ke,"INPUT",{type:!0,name:!0}),Jt=T(Ke),be=a(Ke,"INPUT",{type:!0,min:!0,max:!0}),Qt=T(Ke),_e=a(Ke,"DIV",{style:!0});var vn=k(_e);for(let en=0;en<X.length;en+=1)X[en].l(vn);vn.forEach(y),Ke.forEach(y),f.forEach(y),this.h()},h(){d(e,"type","file"),d(e,"accept","image/png"),d(c,"for","name"),d(M,"name","name"),d(M,"type","text"),i(p,"display","flex"),i(p,"flex-direction","column"),i(p,"align-items","start"),d(N,"for","width"),d(V,"name","width"),d(V,"type","number"),d(V,"min","1"),d(V,"max","64"),i(V,"max-width","4em"),i(C,"display","flex"),i(C,"flex-direction","column"),i(C,"align-items","start"),d(E,"for","height"),d(Y,"name","height"),d(Y,"type","number"),d(Y,"min","1"),d(Y,"max","64"),i(Y,"max-width","4em"),i(W,"display","flex"),i(W,"flex-direction","column"),i(W,"align-items","start"),d(ke,"for","margin"),d(F,"name","margin"),d(F,"type","number"),d(F,"min","1"),d(F,"max","64"),i(F,"max-width","4em"),i(ne,"display","flex"),i(ne,"flex-direction","column"),i(ne,"align-items","start"),d(we,"for","spacing"),d(U,"name","spacing"),d(U,"type","number"),d(U,"min","1"),d(U,"max","64"),i(U,"max-width","4em"),i(le,"display","flex"),i(le,"flex-direction","column"),i(le,"align-items","start"),d(Ee,"for","type"),ae.__value="square",A(ae,ae.__value),ue.__value="hex",A(ue,ue.__value),d(ee,"name","type"),l[0].type===void 0&&Mn(()=>l[31].call(ee)),i(j,"display","flex"),i(j,"flex-direction","column"),i(j,"align-items","start"),He(he,"active",l[4]===b.Select),se.disabled=nt=!l[0].selectedTiles.length,He(se,"active",l[4]===b.Edit),re.disabled=lt=!l[0].selectedTiles.length,He(re,"active",l[4]===b.Erase),ie.disabled=st=!l[0].selectedTiles.length,He(ie,"active",l[4]===b.Move),pe.disabled=rt=!l[0].selectedTiles.length,h.disabled=O=!l[0].selectedTiles.length,d(P,"type","number"),d(P,"min","0"),d(P,"max","90"),P.disabled=je=l[0].selectedTiles.length!==1,D.disabled=ze=!l[0].selectedTiles.length,Be.disabled=Et=l[0].undoer.undoStack.length===0,Pe.disabled=It=l[0].undoer.redoStack.length===0,Ae.disabled=Ct=!l[0].selectedTiles.length,Oe.disabled=Dt=!l[0].selectedTiles.length,Le.disabled=St=!l[0].selectedTiles.length,Ve.disabled=Mt=!l[0].copyBuffer.length||!l[0].selectedTiles.length,We.disabled=Nt=!l[0].img,i(g,"margin-left","auto"),i(g,"display","flex"),i(g,"gap","8px"),i(n,"display","flex"),i(n,"gap","8px"),i(n,"align-items","end"),i(n,"flex-wrap","wrap"),d(me,"name","filter"),d(me,"type","text"),d(me,"placeholder","Filter"),i(Ye,"display","flex"),i(Ye,"gap","8px"),i(Ye,"align-items","end"),i(te,"position","absolute"),d(it,"class","canvas svelte-16cu0gi"),d(et,"for","tags"),d(de,"name","tags"),d(de,"type","text"),i(ge,"display","flex"),i(ge,"flex-direction","column"),i(ge,"align-items","start"),d(Xe,"type","color"),d(Xe,"name","color"),Xe.value=Ut=l[6].substring(0,Math.min(l[6].length,7)),d(be,"type","range"),d(be,"min","0"),d(be,"max","255"),i(_e,"display","flex"),i(_e,"flex-direction","row"),i(_e,"flex-wrap","wrap"),i(_e,"gap","12px"),i(R,"display","flex"),i(R,"flex-direction","row"),i(R,"gap","8px"),i(R,"align-items","start"),i(u,"display","flex"),i(u,"flex-direction","column"),i(u,"gap","8px"),i(u,"flex-grow","1"),i(u,"max-width",l[1])},m(s,f){Dn(s,u,f),r(u,n),r(n,e),r(n,K),r(n,p),r(p,c),r(p,Re),r(p,M),A(M,l[0].name),r(n,L),r(n,C),r(C,N),r(C,Te),r(C,V),A(V,l[0].tilewidth),r(n,ye),r(n,W),r(W,E),r(W,oe),r(W,Y),A(Y,l[0].tileheight),r(n,Fe),r(n,ne),r(ne,ke),r(ne,at),r(ne,F),A(F,l[0].margin),r(n,ut),r(n,le),r(le,we),r(le,ft),r(le,U),A(U,l[0].spacing),r(n,dt),r(n,j),r(j,Ee),r(j,ct),r(j,ee),r(ee,ae),r(ee,ue),yn(ee,l[0].type,!0),r(n,ht),r(n,g),r(g,he),G(Ie,he,null),r(g,pt),r(g,se),G(Ce,se,null),r(g,mt),r(g,re),G(De,re,null),r(g,gt),r(g,ie),G(Se,ie,null),r(g,bt),r(g,pe),G(Me,pe,null),r(g,t),r(g,h),G(w,h,null),r(g,H),r(g,D),G(S,D,null),r(D,fe),r(D,P),A(P,l[10]),r(g,_t),r(g,Be),G(qe,Be,null),r(g,Yt),r(g,Pe),G(Ge,Pe,null),r(g,Xt),r(g,Ae),G(Ze,Ae,null),r(g,Kt),r(g,Oe),G(Je,Oe,null),r(g,Ht),r(g,Le),G(Qe,Le,null),r(g,Rt),r(g,Ve),G(xe,Ve,null),r(g,Ft),r(g,We),G($e,We,null),r(u,jt),r(u,Ye),r(Ye,me),A(me,l[3]),r(u,zt),r(u,it),r(it,te),l[48](te),r(u,qt),r(u,R),r(R,ge),r(ge,et),r(ge,Gt),r(ge,de),A(de,l[8]),l[52](de),r(R,Zt),r(R,Xe),r(R,Jt),r(R,be),A(be,l[5]),r(R,Qt),r(R,_e);for(let _=0;_<X.length;_+=1)X[_]&&X[_].m(_e,null);B=!0,xt||(nn=[m(window,"keydown",l[20]),m(e,"change",l[17]),m(M,"input",l[26]),m(V,"input",l[27]),m(Y,"input",l[28]),m(F,"input",l[29]),m(U,"input",l[30]),m(ee,"change",l[31]),m(he,"click",l[32]),m(se,"click",l[33]),m(re,"click",l[34]),m(ie,"click",l[35]),m(pe,"click",l[36]),m(h,"click",l[37]),m(P,"input",l[38]),m(P,"click",Kn),m(D,"click",l[39]),m(Be,"click",l[40]),m(Pe,"click",l[41]),m(Ae,"click",l[42]),m(Oe,"click",l[43]),m(Le,"click",l[44]),m(Ve,"click",l[45]),m(We,"click",l[46]),m(me,"input",l[47]),m(te,"wheel",l[11]),m(te,"pointerup",l[16]),m(te,"pointerdown",l[13]),m(te,"pointermove",l[14]),m(te,"pointercancel",l[15]),m(te,"pointerenter",l[49]),m(te,"pointerleave",l[50]),m(de,"change",l[18]),m(de,"input",l[51]),m(Xe,"change",l[12]),m(be,"change",l[53]),m(be,"input",l[53])],xt=!0)},p(s,f){if(f[0]&1&&M.value!==s[0].name&&A(M,s[0].name),f[0]&1&&ce(V.value)!==s[0].tilewidth&&A(V,s[0].tilewidth),f[0]&1&&ce(Y.value)!==s[0].tileheight&&A(Y,s[0].tileheight),f[0]&1&&ce(F.value)!==s[0].margin&&A(F,s[0].margin),f[0]&1&&ce(U.value)!==s[0].spacing&&A(U,s[0].spacing),f[0]&1&&yn(ee,s[0].type),(!B||f[0]&16)&&He(he,"active",s[4]===b.Select),(!B||f[0]&1&&nt!==(nt=!s[0].selectedTiles.length))&&(se.disabled=nt),(!B||f[0]&16)&&He(se,"active",s[4]===b.Edit),(!B||f[0]&1&&lt!==(lt=!s[0].selectedTiles.length))&&(re.disabled=lt),(!B||f[0]&16)&&He(re,"active",s[4]===b.Erase),(!B||f[0]&1&&st!==(st=!s[0].selectedTiles.length))&&(ie.disabled=st),(!B||f[0]&16)&&He(ie,"active",s[4]===b.Move),(!B||f[0]&1&&rt!==(rt=!s[0].selectedTiles.length))&&(pe.disabled=rt),(!B||f[0]&1&&O!==(O=!s[0].selectedTiles.length))&&(h.disabled=O),(!B||f[0]&1&&je!==(je=s[0].selectedTiles.length!==1))&&(P.disabled=je),f[0]&1024&&ce(P.value)!==s[10]&&A(P,s[10]),(!B||f[0]&1&&ze!==(ze=!s[0].selectedTiles.length))&&(D.disabled=ze),(!B||f[0]&1&&Et!==(Et=s[0].undoer.undoStack.length===0))&&(Be.disabled=Et),(!B||f[0]&1&&It!==(It=s[0].undoer.redoStack.length===0))&&(Pe.disabled=It),(!B||f[0]&1&&Ct!==(Ct=!s[0].selectedTiles.length))&&(Ae.disabled=Ct),(!B||f[0]&1&&Dt!==(Dt=!s[0].selectedTiles.length))&&(Oe.disabled=Dt),(!B||f[0]&1&&St!==(St=!s[0].selectedTiles.length))&&(Le.disabled=St),(!B||f[0]&1&&Mt!==(Mt=!s[0].copyBuffer.length||!s[0].selectedTiles.length))&&(Ve.disabled=Mt),(!B||f[0]&1&&Nt!==(Nt=!s[0].img))&&(We.disabled=Nt),f[0]&8&&me.value!==s[3]&&A(me,s[3]),f[0]&256&&de.value!==s[8]&&A(de,s[8]),(!B||f[0]&64&&Ut!==(Ut=s[6].substring(0,Math.min(s[6].length,7))))&&(Xe.value=Ut),f[0]&32&&A(be,s[5]),f[0]&4097){ot=En(s[0].palette());let _;for(_=0;_<ot.length;_+=1){const tt=In(s,ot,_);X[_]?X[_].p(tt,f):(X[_]=Cn(tt),X[_].c(),X[_].m(_e,null))}for(;_<X.length;_+=1)X[_].d(1);X.length=ot.length}f[0]&2&&i(u,"max-width",s[1])},i(s){B||(Z(Ie.$$.fragment,s),Z(Ce.$$.fragment,s),Z(De.$$.fragment,s),Z(Se.$$.fragment,s),Z(Me.$$.fragment,s),Z(w.$$.fragment,s),Z(S.$$.fragment,s),Z(qe.$$.fragment,s),Z(Ge.$$.fragment,s),Z(Ze.$$.fragment,s),Z(Je.$$.fragment,s),Z(Qe.$$.fragment,s),Z(xe.$$.fragment,s),Z($e.$$.fragment,s),B=!0)},o(s){J(Ie.$$.fragment,s),J(Ce.$$.fragment,s),J(De.$$.fragment,s),J(Se.$$.fragment,s),J(Me.$$.fragment,s),J(w.$$.fragment,s),J(S.$$.fragment,s),J(qe.$$.fragment,s),J(Ge.$$.fragment,s),J(Ze.$$.fragment,s),J(Je.$$.fragment,s),J(Qe.$$.fragment,s),J(xe.$$.fragment,s),J($e.$$.fragment,s),B=!1},d(s){s&&y(u),Q(Ie),Q(Ce),Q(De),Q(Se),Q(Me),Q(w),Q(S),Q(qe),Q(Ge),Q(Ze),Q(Je),Q(Qe),Q(xe),Q($e),l[48](null),l[52](null),Pn(X,s),xt=!1,Nn(nn)}}}var b=(l=>(l[l.Select=0]="Select",l[l.Edit=1]="Edit",l[l.Erase=2]="Erase",l[l.Move=3]="Move",l))(b||{});function Yn(l){if(l.startsWith("#")){const u=l.match(/^#(\w{2})(\w{2})(\w{2})(\w{2})?$/);return u?[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16),parseInt(u[4],16)||255]:void 0}else if(l.startsWith("rgb")){const u=l.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*(0\.\d+)?\)$/);return u?[parseInt(u[1]),parseInt(u[2]),parseInt(u[3]),Math.round(parseFloat(u[4])*255)||255]:void 0}}function Xn(l){const[u,n,e,K]=l;function p(c){return isNaN(c)?"":("0"+c.toString(16)).slice(-2)}return"#"+p(u)+p(n)+p(e)+p(K)}const Kn=l=>l.stopPropagation();function Hn(l,u,n){let{tileset:e=new kn({})}=u,{maxWidth:K=void 0}=u,p,c=2,ve=!1,Re=!1,M=0,L=0,C,N,Ue,Te,V="",ye,W="",E=b.Select,$="#ffffff",oe=255,Y=90;function Fe(t,h){return[(t-M)/c,(h-L)/c]}function ne(t,h){return[t*c+M,h*c+L]}function ke(){var O,H;if(!p)return;const t=p.getContext("2d");if(!t)return;const h=(((O=p.parentElement)==null?void 0:O.scrollWidth)||0)-4,w=(((H=p.parentElement)==null?void 0:H.scrollHeight)||0)-4;if(n(7,p.width=h,p),n(7,p.height=w,p),t.imageSmoothingEnabled=!1,t.resetTransform(),t.clearRect(0,0,h,w),t.setTransform(c,0,0,c,M,L),e.tiles)for(let D=0;D<e.tiles.length;D++){const S=e.tiles[D];if(!S.img)continue;const[fe,P]=e.tileToImgCoords(S.tileX,S.tileY),[je,ze]=ne(fe,P);je<-e.tilewidth*c||ze<-e.tileheight*c||je>h||ze>w||(W===""||e.getTileData(S.tileX,S.tileY,"tags",[]).some(_t=>_t.startsWith(W)))&&t.drawImage(S.img,0,0,e.tilewidth,e.tileheight,fe,P,e.tilewidth,e.tileheight)}else if(e.img)t.drawImage(e.img,0,0);else{j();return}if(!(C===void 0||N===void 0)){if(t.lineWidth=1/c,ve)if(E===b.Select){const[D,S]=e.imgCoordsToTile(C,N),[fe,P]=e.tileToImgCoords(D,S);D!=null&&S!==void 0&&(t.strokeStyle="#ffffffaa",wn(t,fe,P,e.tilewidth,e.tileheight))}else(E===b.Edit||E===b.Erase)&&(t.fillStyle=$,E===b.Erase&&(t.fillStyle="white"),t.fillRect(Math.floor(C),Math.floor(N),1,1));t.strokeStyle="white",e.selectedTiles.forEach(D=>{const[S,fe]=e.tileToImgCoords(D[0],D[1]);if(wn(t,S,fe,e.tilewidth,e.tileheight),(E===b.Edit||E===b.Erase||E===b.Move)&&e.type==="hex"){const P=e.radius();On(t,S+.5*e.tilewidth,fe+e.tileheight-P,P)}}),e.rendering&&j()}}function vt(t){const h=c;t.deltaY<0?n(21,c*=1.1):t.deltaY>0&&n(21,c*=.9),n(21,c=Math.min(Math.max(.05,c),16)),n(22,M=-c*(t.offsetX-M)/h+t.offsetX),n(23,L=-c*(t.offsetY-L)/h+t.offsetY)}function at(t){let h;if(t.target instanceof HTMLButtonElement)h=t.target.style.backgroundColor;else if(t.target instanceof HTMLInputElement)h=t.target.value;else return;const w=Yn(h);w&&(n(6,$=Xn(w)),n(5,oe=w[3]),U(b.Edit))}function F(t){if(n(24,[C,N]=Fe(t.offsetX,t.offsetY),C,n(25,N)),[Ue,Te]=[C,N],Re=!0,E===b.Edit)e.undoer.begin(),e.setPixel(Math.floor(C),Math.floor(N),parseInt($.slice(1,3),16),parseInt($.slice(3,5),16),parseInt($.slice(5,7),16),Math.round(oe)),n(0,e);else if(E===b.Erase)e.undoer.begin(),e.setPixel(Math.floor(C),Math.floor(N),0,0,0,0),n(0,e);else if(E==b.Select){const[h,w]=Fe(t.offsetX,t.offsetY);if(!e.img||h<0||h>=e.img.width||w<0||w>=e.img.height)return;const[O,H]=e.imgCoordsToTile(h,w);t.shiftKey?e.toggleSelectedTile(O,H):(e.setSelectedTile(O,H),ye&&ye.focus()),n(8,V=Array.from(e.selectionTags().values()).join(",")),n(0,e)}}function ut(t){if(t.ctrlKey&&(n(22,M+=t.movementX),n(23,L+=t.movementY)),n(24,[C,N]=Fe(t.offsetX,t.offsetY),C,n(25,N)),Re){if(E===b.Edit)e.setPixel(Math.floor(C),Math.floor(N),parseInt($.slice(1,3),16),parseInt($.slice(3,5),16),parseInt($.slice(5,7),16),Math.round(oe)),n(0,e);else if(E===b.Erase)e.setPixel(Math.floor(C),Math.floor(N),0,0,0,0),n(0,e);else if(E==b.Select&&Ue!==void 0&&Te!==void 0){e.clearSelectedTiles();let[h,w]=e.imgCoordsToTile(Ue,Te),[O,H]=e.imgCoordsToTile(C,N);h>O&&([h,O]=[O,h]),w>H&&([w,H]=[H,w]);for(let D=h;D<=O;D++)for(let S=w;S<=H;S++)e.toggleSelectedTile(D,S);n(0,e)}}}function le(t){[Ue,Te]=[void 0,void 0],e.undoer.end(),n(0,e)}function we(t){Re=!1,[Ue,Te]=[void 0,void 0],e.undoer.end(),n(0,e)}function Tt(t){if(t.target===null)return;const h=t.target.files;if(h===null)return;const w=h[0];w&&kn.loadFromFile(w).then(O=>{n(0,e=O),n(22,M=0),n(23,L=0),n(21,c=2)})}function ft(t){const h=new Set(t.target.value.split(","));e.setSelectionTags(h),n(8,V=Array.from(e.selectionTags().values()).join(","))}function U(t){n(4,E=t)}function dt(t){if(ve)switch(!0){case t.key==="s":U(b.Select),t.preventDefault();break;case t.key==="e":U(b.Erase),t.preventDefault();break;case t.key==="d":U(b.Edit),t.preventDefault();break;case t.key==="m":U(b.Move),t.preventDefault();break;case(t.key==="z"&&t.ctrlKey):e.undo(),n(0,e),t.preventDefault();break;case(t.key==="y"&&t.ctrlKey):e.redo(),n(0,e),t.preventDefault();break;case(t.key==="s"&&t.ctrlKey):e.download(),n(0,e),t.preventDefault();break;case(t.key==="x"&&t.ctrlKey):e.cut(),n(0,e),t.preventDefault();break;case(t.key==="c"&&t.ctrlKey):e.copy(),n(0,e),t.preventDefault();break;case(t.key==="v"&&t.ctrlKey):e.paste(),n(0,e),t.preventDefault();break;case(t.key==="Backspace"||t.key==="Delete"):e.clear(),n(0,e),t.preventDefault();break;case(t.key==="z"&&e.selectedTiles.length===1):const[h,w]=[(p==null?void 0:p.width)||0,(p==null?void 0:p.height)||0],O=Math.min(h,w)/Math.max(e.tilewidth,e.tileheight),[H,D]=e.tileToImgCoords(e.selectedTiles[0][0],e.selectedTiles[0][1]);n(21,c=O);const S=h/2-e.tilewidth*c/2;n(22,M=-H*c+S),n(23,L=-D*c),t.preventDefault();break;case(t.key==="i"&&e.selectedTiles.length===1):e.setSelectedTile(e.selectedTiles[0][0],e.selectedTiles[0][1]-1),n(0,e),t.preventDefault();break;case(t.key==="k"&&e.selectedTiles.length===1):e.setSelectedTile(e.selectedTiles[0][0],e.selectedTiles[0][1]+1),n(0,e),t.preventDefault();break;case(t.key==="j"&&e.selectedTiles.length===1):e.setSelectedTile(e.selectedTiles[0][0]-1,e.selectedTiles[0][1]),n(0,e),t.preventDefault();break;case(t.key==="l"&&e.selectedTiles.length===1):e.setSelectedTile(e.selectedTiles[0][0]+1,e.selectedTiles[0][1]),n(0,e),t.preventDefault();break;case(t.key==="ArrowLeft"&&E===b.Move):e.move(-1,0),n(0,e),t.preventDefault();break;case(t.key==="ArrowRight"&&E===b.Move):e.move(1,0),n(0,e),t.preventDefault();break;case(t.key==="ArrowUp"&&E===b.Move):e.move(0,-1),n(0,e),t.preventDefault();break;case(t.key==="ArrowDown"&&E===b.Move):e.move(0,1),n(0,e),t.preventDefault();break;case t.key==="ArrowLeft":t.shiftKey?n(22,M+=c):n(22,M+=c*e.offsetWidth()),t.preventDefault();break;case t.key==="ArrowRight":t.shiftKey?n(22,M-=c):n(22,M-=c*e.offsetWidth()),t.preventDefault();break;case t.key==="ArrowUp":t.shiftKey?n(23,L+=c):n(23,L+=c*e.offsetHeight()),t.preventDefault();break;case t.key==="ArrowDown":t.shiftKey?n(23,L-=c):n(23,L-=c*e.offsetHeight()),t.preventDefault();break;case t.key==="Escape":e.clearSelectedTiles(),n(0,e),t.preventDefault();break}}function j(...t){e&&Vn&&requestAnimationFrame(ke)}function Ee(){e.name=this.value,n(0,e)}function yt(){e.tilewidth=ce(this.value),n(0,e)}function ct(){e.tileheight=ce(this.value),n(0,e)}function ee(){e.margin=ce(this.value),n(0,e)}function ae(){e.spacing=ce(this.value),n(0,e)}function kt(){e.type=An(this),n(0,e)}const ue=()=>U(b.Select),wt=()=>U(b.Edit),ht=()=>U(b.Erase),g=()=>U(b.Move),he=()=>{e.flip("y"),n(0,e)},Ie=()=>{e.flip("x"),n(0,e)};function pt(){Y=ce(this.value),n(10,Y)}const se=()=>{e.rotate(Y),n(0,e)},Ce=()=>{e.undo(),n(0,e)},nt=()=>{e.redo(),n(0,e)},mt=()=>{e.clear(),n(0,e)},re=()=>{e.cut(),n(0,e)},De=()=>{e.copy(),n(0,e)},lt=()=>{e.paste(),n(0,e)},gt=()=>e.download();function ie(){W=this.value,n(3,W)}function Se(t){Tn[t?"unshift":"push"](()=>{p=t,n(7,p)})}const st=()=>{p&&p.focus(),n(2,ve=!0)},bt=()=>{n(2,ve=!1)};function pe(){V=this.value,n(8,V)}function Me(t){Tn[t?"unshift":"push"](()=>{ye=t,n(9,ye)})}function rt(){oe=ce(this.value),n(5,oe)}return l.$$set=t=>{"tileset"in t&&n(0,e=t.tileset),"maxWidth"in t&&n(1,K=t.maxWidth)},l.$$.update=()=>{l.$$.dirty[0]&65011837&&j(e,$,oe,E,c,M,L,W,C,N,ve)},[e,K,ve,W,E,oe,$,p,V,ye,Y,vt,at,F,ut,le,we,Tt,ft,U,dt,c,M,L,C,N,Ee,yt,ct,ee,ae,kt,ue,wt,ht,g,he,Ie,pt,se,Ce,nt,mt,re,De,lt,gt,ie,Se,st,bt,pe,Me,rt]}class qn extends Un{constructor(u){super(),Bn(this,u,Hn,Wn,Sn,{tileset:0,maxWidth:1},null,[-1,-1,-1])}}export{qn as T,En as e};
