var gn=Object.defineProperty;var wn=(t,i,e)=>i in t?gn(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var A=(t,i,e)=>(wn(t,typeof i!="symbol"?i+"":i,e),e);async function bn(t){return new Promise((i,e)=>{const n=new FileReader;n.addEventListener("load",function(){n.result?i(n.result):e(`error loading ${t}`)}),n.readAsBinaryString(t)})}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const pn=4,Ne=0,Be=1,xn=2;function pt(t){let i=t.length;for(;--i>=0;)t[i]=0}const mn=0,Ti=1,yn=2,kn=3,vn=258,Se=29,Bt=256,zt=Bt+1+Se,_t=30,Ae=19,Si=2*zt+1,it=15,ie=16,En=7,ze=256,Ai=16,zi=17,Ii=18,be=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),qt=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Tn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ri=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sn=512,Y=new Array((zt+2)*2);pt(Y);const Et=new Array(_t*2);pt(Et);const It=new Array(Sn);pt(It);const Rt=new Array(vn-kn+1);pt(Rt);const Ie=new Array(Se);pt(Ie);const Wt=new Array(_t);pt(Wt);function ne(t,i,e,n,a){this.static_tree=t,this.extra_bits=i,this.extra_base=e,this.elems=n,this.max_length=a,this.has_stree=t&&t.length}let Di,Oi,Zi;function ae(t,i){this.dyn_tree=t,this.max_code=0,this.stat_desc=i}const Mi=t=>t<256?It[t]:It[256+(t>>>7)],Dt=(t,i)=>{t.pending_buf[t.pending++]=i&255,t.pending_buf[t.pending++]=i>>>8&255},N=(t,i,e)=>{t.bi_valid>ie-e?(t.bi_buf|=i<<t.bi_valid&65535,Dt(t,t.bi_buf),t.bi_buf=i>>ie-t.bi_valid,t.bi_valid+=e-ie):(t.bi_buf|=i<<t.bi_valid&65535,t.bi_valid+=e)},K=(t,i,e)=>{N(t,e[i*2],e[i*2+1])},Ui=(t,i)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--i>0);return e>>>1},An=t=>{t.bi_valid===16?(Dt(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},zn=(t,i)=>{const e=i.dyn_tree,n=i.max_code,a=i.stat_desc.static_tree,r=i.stat_desc.has_stree,l=i.stat_desc.extra_bits,o=i.stat_desc.extra_base,f=i.stat_desc.max_length;let s,h,u,c,d,g,I=0;for(c=0;c<=it;c++)t.bl_count[c]=0;for(e[t.heap[t.heap_max]*2+1]=0,s=t.heap_max+1;s<Si;s++)h=t.heap[s],c=e[e[h*2+1]*2+1]+1,c>f&&(c=f,I++),e[h*2+1]=c,!(h>n)&&(t.bl_count[c]++,d=0,h>=o&&(d=l[h-o]),g=e[h*2],t.opt_len+=g*(c+d),r&&(t.static_len+=g*(a[h*2+1]+d)));if(I!==0){do{for(c=f-1;t.bl_count[c]===0;)c--;t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[f]--,I-=2}while(I>0);for(c=f;c!==0;c--)for(h=t.bl_count[c];h!==0;)u=t.heap[--s],!(u>n)&&(e[u*2+1]!==c&&(t.opt_len+=(c-e[u*2+1])*e[u*2],e[u*2+1]=c),h--)}},Ni=(t,i,e)=>{const n=new Array(it+1);let a=0,r,l;for(r=1;r<=it;r++)a=a+e[r-1]<<1,n[r]=a;for(l=0;l<=i;l++){let o=t[l*2+1];o!==0&&(t[l*2]=Ui(n[o]++,o))}},In=()=>{let t,i,e,n,a;const r=new Array(it+1);for(e=0,n=0;n<Se-1;n++)for(Ie[n]=e,t=0;t<1<<be[n];t++)Rt[e++]=n;for(Rt[e-1]=n,a=0,n=0;n<16;n++)for(Wt[n]=a,t=0;t<1<<qt[n];t++)It[a++]=n;for(a>>=7;n<_t;n++)for(Wt[n]=a<<7,t=0;t<1<<qt[n]-7;t++)It[256+a++]=n;for(i=0;i<=it;i++)r[i]=0;for(t=0;t<=143;)Y[t*2+1]=8,t++,r[8]++;for(;t<=255;)Y[t*2+1]=9,t++,r[9]++;for(;t<=279;)Y[t*2+1]=7,t++,r[7]++;for(;t<=287;)Y[t*2+1]=8,t++,r[8]++;for(Ni(Y,zt+1,r),t=0;t<_t;t++)Et[t*2+1]=5,Et[t*2]=Ui(t,5);Di=new ne(Y,be,Bt+1,zt,it),Oi=new ne(Et,qt,0,_t,it),Zi=new ne(new Array(0),Tn,0,Ae,En)},Bi=t=>{let i;for(i=0;i<zt;i++)t.dyn_ltree[i*2]=0;for(i=0;i<_t;i++)t.dyn_dtree[i*2]=0;for(i=0;i<Ae;i++)t.bl_tree[i*2]=0;t.dyn_ltree[ze*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Li=t=>{t.bi_valid>8?Dt(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Le=(t,i,e,n)=>{const a=i*2,r=e*2;return t[a]<t[r]||t[a]===t[r]&&n[i]<=n[e]},re=(t,i,e)=>{const n=t.heap[e];let a=e<<1;for(;a<=t.heap_len&&(a<t.heap_len&&Le(i,t.heap[a+1],t.heap[a],t.depth)&&a++,!Le(i,n,t.heap[a],t.depth));)t.heap[e]=t.heap[a],e=a,a<<=1;t.heap[e]=n},Ce=(t,i,e)=>{let n,a,r=0,l,o;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+r++]&255,n+=(t.pending_buf[t.sym_buf+r++]&255)<<8,a=t.pending_buf[t.sym_buf+r++],n===0?K(t,a,i):(l=Rt[a],K(t,l+Bt+1,i),o=be[l],o!==0&&(a-=Ie[l],N(t,a,o)),n--,l=Mi(n),K(t,l,e),o=qt[l],o!==0&&(n-=Wt[l],N(t,n,o)));while(r<t.sym_next);K(t,ze,i)},pe=(t,i)=>{const e=i.dyn_tree,n=i.stat_desc.static_tree,a=i.stat_desc.has_stree,r=i.stat_desc.elems;let l,o,f=-1,s;for(t.heap_len=0,t.heap_max=Si,l=0;l<r;l++)e[l*2]!==0?(t.heap[++t.heap_len]=f=l,t.depth[l]=0):e[l*2+1]=0;for(;t.heap_len<2;)s=t.heap[++t.heap_len]=f<2?++f:0,e[s*2]=1,t.depth[s]=0,t.opt_len--,a&&(t.static_len-=n[s*2+1]);for(i.max_code=f,l=t.heap_len>>1;l>=1;l--)re(t,e,l);s=r;do l=t.heap[1],t.heap[1]=t.heap[t.heap_len--],re(t,e,1),o=t.heap[1],t.heap[--t.heap_max]=l,t.heap[--t.heap_max]=o,e[s*2]=e[l*2]+e[o*2],t.depth[s]=(t.depth[l]>=t.depth[o]?t.depth[l]:t.depth[o])+1,e[l*2+1]=e[o*2+1]=s,t.heap[1]=s++,re(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],zn(t,i),Ni(e,f,t.bl_count)},$e=(t,i,e)=>{let n,a=-1,r,l=i[0*2+1],o=0,f=7,s=4;for(l===0&&(f=138,s=3),i[(e+1)*2+1]=65535,n=0;n<=e;n++)r=l,l=i[(n+1)*2+1],!(++o<f&&r===l)&&(o<s?t.bl_tree[r*2]+=o:r!==0?(r!==a&&t.bl_tree[r*2]++,t.bl_tree[Ai*2]++):o<=10?t.bl_tree[zi*2]++:t.bl_tree[Ii*2]++,o=0,a=r,l===0?(f=138,s=3):r===l?(f=6,s=3):(f=7,s=4))},He=(t,i,e)=>{let n,a=-1,r,l=i[0*2+1],o=0,f=7,s=4;for(l===0&&(f=138,s=3),n=0;n<=e;n++)if(r=l,l=i[(n+1)*2+1],!(++o<f&&r===l)){if(o<s)do K(t,r,t.bl_tree);while(--o!==0);else r!==0?(r!==a&&(K(t,r,t.bl_tree),o--),K(t,Ai,t.bl_tree),N(t,o-3,2)):o<=10?(K(t,zi,t.bl_tree),N(t,o-3,3)):(K(t,Ii,t.bl_tree),N(t,o-11,7));o=0,a=r,l===0?(f=138,s=3):r===l?(f=6,s=3):(f=7,s=4)}},Rn=t=>{let i;for($e(t,t.dyn_ltree,t.l_desc.max_code),$e(t,t.dyn_dtree,t.d_desc.max_code),pe(t,t.bl_desc),i=Ae-1;i>=3&&t.bl_tree[Ri[i]*2+1]===0;i--);return t.opt_len+=3*(i+1)+5+5+4,i},Dn=(t,i,e,n)=>{let a;for(N(t,i-257,5),N(t,e-1,5),N(t,n-4,4),a=0;a<n;a++)N(t,t.bl_tree[Ri[a]*2+1],3);He(t,t.dyn_ltree,i-1),He(t,t.dyn_dtree,e-1)},On=t=>{let i=4093624447,e;for(e=0;e<=31;e++,i>>>=1)if(i&1&&t.dyn_ltree[e*2]!==0)return Ne;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Be;for(e=32;e<Bt;e++)if(t.dyn_ltree[e*2]!==0)return Be;return Ne};let Fe=!1;const Zn=t=>{Fe||(In(),Fe=!0),t.l_desc=new ae(t.dyn_ltree,Di),t.d_desc=new ae(t.dyn_dtree,Oi),t.bl_desc=new ae(t.bl_tree,Zi),t.bi_buf=0,t.bi_valid=0,Bi(t)},Ci=(t,i,e,n)=>{N(t,(mn<<1)+(n?1:0),3),Li(t),Dt(t,e),Dt(t,~e),e&&t.pending_buf.set(t.window.subarray(i,i+e),t.pending),t.pending+=e},Mn=t=>{N(t,Ti<<1,3),K(t,ze,Y),An(t)},Un=(t,i,e,n)=>{let a,r,l=0;t.level>0?(t.strm.data_type===xn&&(t.strm.data_type=On(t)),pe(t,t.l_desc),pe(t,t.d_desc),l=Rn(t),a=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=a&&(a=r)):a=r=e+5,e+4<=a&&i!==-1?Ci(t,i,e,n):t.strategy===pn||r===a?(N(t,(Ti<<1)+(n?1:0),3),Ce(t,Y,Et)):(N(t,(yn<<1)+(n?1:0),3),Dn(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),Ce(t,t.dyn_ltree,t.dyn_dtree)),Bi(t),n&&Li(t)},Nn=(t,i,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=i,t.pending_buf[t.sym_buf+t.sym_next++]=i>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,i===0?t.dyn_ltree[e*2]++:(t.matches++,i--,t.dyn_ltree[(Rt[e]+Bt+1)*2]++,t.dyn_dtree[Mi(i)*2]++),t.sym_next===t.sym_end);var Bn=Zn,Ln=Ci,Cn=Un,$n=Nn,Hn=Mn,Fn={_tr_init:Bn,_tr_stored_block:Ln,_tr_flush_block:Cn,_tr_tally:$n,_tr_align:Hn};const Pn=(t,i,e,n)=>{let a=t&65535|0,r=t>>>16&65535|0,l=0;for(;e!==0;){l=e>2e3?2e3:e,e-=l;do a=a+i[n++]|0,r=r+a|0;while(--l);a%=65521,r%=65521}return a|r<<16|0};var Ot=Pn;const Kn=()=>{let t,i=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;i[e]=t}return i},jn=new Uint32Array(Kn()),Xn=(t,i,e,n)=>{const a=jn,r=n+e;t^=-1;for(let l=n;l<r;l++)t=t>>>8^a[(t^i[l])&255];return t^-1};var Z=Xn,rt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},st={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Gn,_tr_stored_block:xe,_tr_flush_block:Yn,_tr_tally:V,_tr_align:qn}=Fn,{Z_NO_FLUSH:Q,Z_PARTIAL_FLUSH:Wn,Z_FULL_FLUSH:Jn,Z_FINISH:$,Z_BLOCK:Pe,Z_OK:M,Z_STREAM_END:Ke,Z_STREAM_ERROR:j,Z_DATA_ERROR:Vn,Z_BUF_ERROR:le,Z_DEFAULT_COMPRESSION:Qn,Z_FILTERED:ta,Z_HUFFMAN_ONLY:Pt,Z_RLE:ea,Z_FIXED:ia,Z_DEFAULT_STRATEGY:na,Z_UNKNOWN:aa,Z_DEFLATED:Qt}=st,ra=9,la=15,oa=8,sa=29,ha=256,me=ha+1+sa,fa=30,da=19,ca=2*me+1,_a=15,y=3,J=258,X=J+y+1,ua=32,wt=42,Re=57,ye=69,ke=73,ve=91,Ee=103,nt=113,kt=666,U=1,xt=2,lt=3,mt=4,ga=3,at=(t,i)=>(t.msg=rt[i],i),je=t=>t*2-(t>4?9:0),W=t=>{let i=t.length;for(;--i>=0;)t[i]=0},wa=t=>{let i,e,n,a=t.w_size;i=t.hash_size,n=i;do e=t.head[--n],t.head[n]=e>=a?e-a:0;while(--i);i=a,n=i;do e=t.prev[--n],t.prev[n]=e>=a?e-a:0;while(--i)};let ba=(t,i,e)=>(i<<t.hash_shift^e)&t.hash_mask,tt=ba;const B=t=>{const i=t.state;let e=i.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+e),t.next_out),t.next_out+=e,i.pending_out+=e,t.total_out+=e,t.avail_out-=e,i.pending-=e,i.pending===0&&(i.pending_out=0))},L=(t,i)=>{Yn(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,i),t.block_start=t.strstart,B(t.strm)},T=(t,i)=>{t.pending_buf[t.pending++]=i},yt=(t,i)=>{t.pending_buf[t.pending++]=i>>>8&255,t.pending_buf[t.pending++]=i&255},Te=(t,i,e,n)=>{let a=t.avail_in;return a>n&&(a=n),a===0?0:(t.avail_in-=a,i.set(t.input.subarray(t.next_in,t.next_in+a),e),t.state.wrap===1?t.adler=Ot(t.adler,i,a,e):t.state.wrap===2&&(t.adler=Z(t.adler,i,a,e)),t.next_in+=a,t.total_in+=a,a)},$i=(t,i)=>{let e=t.max_chain_length,n=t.strstart,a,r,l=t.prev_length,o=t.nice_match;const f=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,s=t.window,h=t.w_mask,u=t.prev,c=t.strstart+J;let d=s[n+l-1],g=s[n+l];t.prev_length>=t.good_match&&(e>>=2),o>t.lookahead&&(o=t.lookahead);do if(a=i,!(s[a+l]!==g||s[a+l-1]!==d||s[a]!==s[n]||s[++a]!==s[n+1])){n+=2,a++;do;while(s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&s[++n]===s[++a]&&n<c);if(r=J-(c-n),n=c-J,r>l){if(t.match_start=i,l=r,r>=o)break;d=s[n+l-1],g=s[n+l]}}while((i=u[i&h])>f&&--e!==0);return l<=t.lookahead?l:t.lookahead},bt=t=>{const i=t.w_size;let e,n,a;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=i+(i-X)&&(t.window.set(t.window.subarray(i,i+i-n),0),t.match_start-=i,t.strstart-=i,t.block_start-=i,t.insert>t.strstart&&(t.insert=t.strstart),wa(t),n+=i),t.strm.avail_in===0)break;if(e=Te(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=e,t.lookahead+t.insert>=y)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=tt(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=tt(t,t.ins_h,t.window[a+y-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<y)););}while(t.lookahead<X&&t.strm.avail_in!==0)},Hi=(t,i)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,a,r,l=0,o=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,a=t.strstart-t.block_start,n>a+t.strm.avail_in&&(n=a+t.strm.avail_in),n>r&&(n=r),n<e&&(n===0&&i!==$||i===Q||n!==a+t.strm.avail_in)))break;l=i===$&&n===a+t.strm.avail_in?1:0,xe(t,0,0,l),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,B(t.strm),a&&(a>n&&(a=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,n-=a),n&&(Te(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(l===0);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),l?mt:i!==Q&&i!==$&&t.strm.avail_in===0&&t.strstart===t.block_start?xt:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(Te(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,e=r>t.w_size?t.w_size:r,a=t.strstart-t.block_start,(a>=e||(a||i===$)&&i!==Q&&t.strm.avail_in===0&&a<=r)&&(n=a>r?r:a,l=i===$&&t.strm.avail_in===0&&n===a?1:0,xe(t,t.block_start,n,l),t.block_start+=n,B(t.strm)),l?lt:U)},oe=(t,i)=>{let e,n;for(;;){if(t.lookahead<X){if(bt(t),t.lookahead<X&&i===Q)return U;if(t.lookahead===0)break}if(e=0,t.lookahead>=y&&(t.ins_h=tt(t,t.ins_h,t.window[t.strstart+y-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-X&&(t.match_length=$i(t,e)),t.match_length>=y)if(n=V(t,t.strstart-t.match_start,t.match_length-y),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=y){t.match_length--;do t.strstart++,t.ins_h=tt(t,t.ins_h,t.window[t.strstart+y-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=tt(t,t.ins_h,t.window[t.strstart+1]);else n=V(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(L(t,!1),t.strm.avail_out===0))return U}return t.insert=t.strstart<y-1?t.strstart:y-1,i===$?(L(t,!0),t.strm.avail_out===0?lt:mt):t.sym_next&&(L(t,!1),t.strm.avail_out===0)?U:xt},ft=(t,i)=>{let e,n,a;for(;;){if(t.lookahead<X){if(bt(t),t.lookahead<X&&i===Q)return U;if(t.lookahead===0)break}if(e=0,t.lookahead>=y&&(t.ins_h=tt(t,t.ins_h,t.window[t.strstart+y-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=y-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-X&&(t.match_length=$i(t,e),t.match_length<=5&&(t.strategy===ta||t.match_length===y&&t.strstart-t.match_start>4096)&&(t.match_length=y-1)),t.prev_length>=y&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-y,n=V(t,t.strstart-1-t.prev_match,t.prev_length-y),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=a&&(t.ins_h=tt(t,t.ins_h,t.window[t.strstart+y-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=y-1,t.strstart++,n&&(L(t,!1),t.strm.avail_out===0))return U}else if(t.match_available){if(n=V(t,0,t.window[t.strstart-1]),n&&L(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return U}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=V(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<y-1?t.strstart:y-1,i===$?(L(t,!0),t.strm.avail_out===0?lt:mt):t.sym_next&&(L(t,!1),t.strm.avail_out===0)?U:xt},pa=(t,i)=>{let e,n,a,r;const l=t.window;for(;;){if(t.lookahead<=J){if(bt(t),t.lookahead<=J&&i===Q)return U;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=y&&t.strstart>0&&(a=t.strstart-1,n=l[a],n===l[++a]&&n===l[++a]&&n===l[++a])){r=t.strstart+J;do;while(n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&a<r);t.match_length=J-(r-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=y?(e=V(t,1,t.match_length-y),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=V(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(L(t,!1),t.strm.avail_out===0))return U}return t.insert=0,i===$?(L(t,!0),t.strm.avail_out===0?lt:mt):t.sym_next&&(L(t,!1),t.strm.avail_out===0)?U:xt},xa=(t,i)=>{let e;for(;;){if(t.lookahead===0&&(bt(t),t.lookahead===0)){if(i===Q)return U;break}if(t.match_length=0,e=V(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(L(t,!1),t.strm.avail_out===0))return U}return t.insert=0,i===$?(L(t,!0),t.strm.avail_out===0?lt:mt):t.sym_next&&(L(t,!1),t.strm.avail_out===0)?U:xt};function P(t,i,e,n,a){this.good_length=t,this.max_lazy=i,this.nice_length=e,this.max_chain=n,this.func=a}const vt=[new P(0,0,0,0,Hi),new P(4,4,8,4,oe),new P(4,5,16,8,oe),new P(4,6,32,32,oe),new P(4,4,16,16,ft),new P(8,16,32,32,ft),new P(8,16,128,128,ft),new P(8,32,128,256,ft),new P(32,128,258,1024,ft),new P(32,258,258,4096,ft)],ma=t=>{t.window_size=2*t.w_size,W(t.head),t.max_lazy_match=vt[t.level].max_lazy,t.good_match=vt[t.level].good_length,t.nice_match=vt[t.level].nice_length,t.max_chain_length=vt[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=y-1,t.match_available=0,t.ins_h=0};function ya(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Qt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(ca*2),this.dyn_dtree=new Uint16Array((2*fa+1)*2),this.bl_tree=new Uint16Array((2*da+1)*2),W(this.dyn_ltree),W(this.dyn_dtree),W(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(_a+1),this.heap=new Uint16Array(2*me+1),W(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*me+1),W(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Lt=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.status!==wt&&i.status!==Re&&i.status!==ye&&i.status!==ke&&i.status!==ve&&i.status!==Ee&&i.status!==nt&&i.status!==kt?1:0},Fi=t=>{if(Lt(t))return at(t,j);t.total_in=t.total_out=0,t.data_type=aa;const i=t.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?Re:i.wrap?wt:nt,t.adler=i.wrap===2?0:1,i.last_flush=-2,Gn(i),M},Pi=t=>{const i=Fi(t);return i===M&&ma(t.state),i},ka=(t,i)=>Lt(t)||t.state.wrap!==2?j:(t.state.gzhead=i,M),Ki=(t,i,e,n,a,r)=>{if(!t)return j;let l=1;if(i===Qn&&(i=6),n<0?(l=0,n=-n):n>15&&(l=2,n-=16),a<1||a>ra||e!==Qt||n<8||n>15||i<0||i>9||r<0||r>ia||n===8&&l!==1)return at(t,j);n===8&&(n=9);const o=new ya;return t.state=o,o.strm=t,o.status=wt,o.wrap=l,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+y-1)/y),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=i,o.strategy=r,o.method=e,Pi(t)},va=(t,i)=>Ki(t,i,Qt,la,oa,na),Ea=(t,i)=>{if(Lt(t)||i>Pe||i<0)return t?at(t,j):j;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===kt&&i!==$)return at(t,t.avail_out===0?le:j);const n=e.last_flush;if(e.last_flush=i,e.pending!==0){if(B(t),t.avail_out===0)return e.last_flush=-1,M}else if(t.avail_in===0&&je(i)<=je(n)&&i!==$)return at(t,le);if(e.status===kt&&t.avail_in!==0)return at(t,le);if(e.status===wt&&e.wrap===0&&(e.status=nt),e.status===wt){let a=Qt+(e.w_bits-8<<4)<<8,r=-1;if(e.strategy>=Pt||e.level<2?r=0:e.level<6?r=1:e.level===6?r=2:r=3,a|=r<<6,e.strstart!==0&&(a|=ua),a+=31-a%31,yt(e,a),e.strstart!==0&&(yt(e,t.adler>>>16),yt(e,t.adler&65535)),t.adler=1,e.status=nt,B(t),e.pending!==0)return e.last_flush=-1,M}if(e.status===Re){if(t.adler=0,T(e,31),T(e,139),T(e,8),e.gzhead)T(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),T(e,e.gzhead.time&255),T(e,e.gzhead.time>>8&255),T(e,e.gzhead.time>>16&255),T(e,e.gzhead.time>>24&255),T(e,e.level===9?2:e.strategy>=Pt||e.level<2?4:0),T(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(T(e,e.gzhead.extra.length&255),T(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=Z(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=ye;else if(T(e,0),T(e,0),T(e,0),T(e,0),T(e,0),T(e,e.level===9?2:e.strategy>=Pt||e.level<2?4:0),T(e,ga),e.status=nt,B(t),e.pending!==0)return e.last_flush=-1,M}if(e.status===ye){if(e.gzhead.extra){let a=e.pending,r=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let o=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex+=o,B(t),e.pending!==0)return e.last_flush=-1,M;a=0,r-=o}let l=new Uint8Array(e.gzhead.extra);e.pending_buf.set(l.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=ke}if(e.status===ke){if(e.gzhead.name){let a=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),B(t),e.pending!==0)return e.last_flush=-1,M;a=0}e.gzindex<e.gzhead.name.length?r=e.gzhead.name.charCodeAt(e.gzindex++)&255:r=0,T(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=ve}if(e.status===ve){if(e.gzhead.comment){let a=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a)),B(t),e.pending!==0)return e.last_flush=-1,M;a=0}e.gzindex<e.gzhead.comment.length?r=e.gzhead.comment.charCodeAt(e.gzindex++)&255:r=0,T(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=Z(t.adler,e.pending_buf,e.pending-a,a))}e.status=Ee}if(e.status===Ee){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(B(t),e.pending!==0))return e.last_flush=-1,M;T(e,t.adler&255),T(e,t.adler>>8&255),t.adler=0}if(e.status=nt,B(t),e.pending!==0)return e.last_flush=-1,M}if(t.avail_in!==0||e.lookahead!==0||i!==Q&&e.status!==kt){let a=e.level===0?Hi(e,i):e.strategy===Pt?xa(e,i):e.strategy===ea?pa(e,i):vt[e.level].func(e,i);if((a===lt||a===mt)&&(e.status=kt),a===U||a===lt)return t.avail_out===0&&(e.last_flush=-1),M;if(a===xt&&(i===Wn?qn(e):i!==Pe&&(xe(e,0,0,!1),i===Jn&&(W(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),B(t),t.avail_out===0))return e.last_flush=-1,M}return i!==$?M:e.wrap<=0?Ke:(e.wrap===2?(T(e,t.adler&255),T(e,t.adler>>8&255),T(e,t.adler>>16&255),T(e,t.adler>>24&255),T(e,t.total_in&255),T(e,t.total_in>>8&255),T(e,t.total_in>>16&255),T(e,t.total_in>>24&255)):(yt(e,t.adler>>>16),yt(e,t.adler&65535)),B(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?M:Ke)},Ta=t=>{if(Lt(t))return j;const i=t.state.status;return t.state=null,i===nt?at(t,Vn):M},Sa=(t,i)=>{let e=i.length;if(Lt(t))return j;const n=t.state,a=n.wrap;if(a===2||a===1&&n.status!==wt||n.lookahead)return j;if(a===1&&(t.adler=Ot(t.adler,i,e,0)),n.wrap=0,e>=n.w_size){a===0&&(W(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(i.subarray(e-n.w_size,e),0),i=f,e=n.w_size}const r=t.avail_in,l=t.next_in,o=t.input;for(t.avail_in=e,t.next_in=0,t.input=i,bt(n);n.lookahead>=y;){let f=n.strstart,s=n.lookahead-(y-1);do n.ins_h=tt(n,n.ins_h,n.window[f+y-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--s);n.strstart=f,n.lookahead=y-1,bt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=y-1,n.match_available=0,t.next_in=l,t.input=o,t.avail_in=r,n.wrap=a,M};var Aa=va,za=Ki,Ia=Pi,Ra=Fi,Da=ka,Oa=Ea,Za=Ta,Ma=Sa,Ua="pako deflate (from Nodeca project)",Tt={deflateInit:Aa,deflateInit2:za,deflateReset:Ia,deflateResetKeep:Ra,deflateSetHeader:Da,deflate:Oa,deflateEnd:Za,deflateSetDictionary:Ma,deflateInfo:Ua};const Na=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);var Ba=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const e=i.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)Na(e,n)&&(t[n]=e[n])}}return t},La=t=>{let i=0;for(let n=0,a=t.length;n<a;n++)i+=t[n].length;const e=new Uint8Array(i);for(let n=0,a=0,r=t.length;n<r;n++){let l=t[n];e.set(l,a),a+=l.length}return e},te={assign:Ba,flattenChunks:La};let ji=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ji=!1}const Zt=new Uint8Array(256);for(let t=0;t<256;t++)Zt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Zt[254]=Zt[254]=1;var Ca=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let i,e,n,a,r,l=t.length,o=0;for(a=0;a<l;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<l&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(i=new Uint8Array(o),r=0,a=0;r<o;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<l&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),e<128?i[r++]=e:e<2048?(i[r++]=192|e>>>6,i[r++]=128|e&63):e<65536?(i[r++]=224|e>>>12,i[r++]=128|e>>>6&63,i[r++]=128|e&63):(i[r++]=240|e>>>18,i[r++]=128|e>>>12&63,i[r++]=128|e>>>6&63,i[r++]=128|e&63);return i};const $a=(t,i)=>{if(i<65534&&t.subarray&&ji)return String.fromCharCode.apply(null,t.length===i?t:t.subarray(0,i));let e="";for(let n=0;n<i;n++)e+=String.fromCharCode(t[n]);return e};var Ha=(t,i)=>{const e=i||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,i));let n,a;const r=new Array(e*2);for(a=0,n=0;n<e;){let l=t[n++];if(l<128){r[a++]=l;continue}let o=Zt[l];if(o>4){r[a++]=65533,n+=o-1;continue}for(l&=o===2?31:o===3?15:7;o>1&&n<e;)l=l<<6|t[n++]&63,o--;if(o>1){r[a++]=65533;continue}l<65536?r[a++]=l:(l-=65536,r[a++]=55296|l>>10&1023,r[a++]=56320|l&1023)}return $a(r,a)},Fa=(t,i)=>{i=i||t.length,i>t.length&&(i=t.length);let e=i-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?i:e+Zt[t[e]]>i?e:i},Mt={string2buf:Ca,buf2string:Ha,utf8border:Fa};function Pa(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Xi=Pa;const Gi=Object.prototype.toString,{Z_NO_FLUSH:Ka,Z_SYNC_FLUSH:ja,Z_FULL_FLUSH:Xa,Z_FINISH:Ga,Z_OK:Jt,Z_STREAM_END:Ya,Z_DEFAULT_COMPRESSION:qa,Z_DEFAULT_STRATEGY:Wa,Z_DEFLATED:Ja}=st;function Ct(t){this.options=te.assign({level:qa,method:Ja,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wa},t||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let e=Tt.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(e!==Jt)throw new Error(rt[e]);if(i.header&&Tt.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=Mt.string2buf(i.dictionary):Gi.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,e=Tt.deflateSetDictionary(this.strm,n),e!==Jt)throw new Error(rt[e]);this._dict_set=!0}}Ct.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize;let a,r;if(this.ended)return!1;for(i===~~i?r=i:r=i===!0?Ga:Ka,typeof t=="string"?e.input=Mt.string2buf(t):Gi.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(r===ja||r===Xa)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(a=Tt.deflate(e,r),a===Ya)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),a=Tt.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Jt;if(e.avail_out===0){this.onData(e.output);continue}if(r>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Ct.prototype.onData=function(t){this.chunks.push(t)};Ct.prototype.onEnd=function(t){t===Jt&&(this.result=te.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function De(t,i){const e=new Ct(i);if(e.push(t,!0),e.err)throw e.msg||rt[e.err];return e.result}function Va(t,i){return i=i||{},i.raw=!0,De(t,i)}function Qa(t,i){return i=i||{},i.gzip=!0,De(t,i)}var tr=Ct,er=De,ir=Va,nr=Qa,ar=st,rr={Deflate:tr,deflate:er,deflateRaw:ir,gzip:nr,constants:ar};const Kt=16209,lr=16191;var or=function(i,e){let n,a,r,l,o,f,s,h,u,c,d,g,I,k,p,S,x,_,E,O,w,z,v,b;const m=i.state;n=i.next_in,v=i.input,a=n+(i.avail_in-5),r=i.next_out,b=i.output,l=r-(e-i.avail_out),o=r+(i.avail_out-257),f=m.dmax,s=m.wsize,h=m.whave,u=m.wnext,c=m.window,d=m.hold,g=m.bits,I=m.lencode,k=m.distcode,p=(1<<m.lenbits)-1,S=(1<<m.distbits)-1;t:do{g<15&&(d+=v[n++]<<g,g+=8,d+=v[n++]<<g,g+=8),x=I[d&p];e:for(;;){if(_=x>>>24,d>>>=_,g-=_,_=x>>>16&255,_===0)b[r++]=x&65535;else if(_&16){E=x&65535,_&=15,_&&(g<_&&(d+=v[n++]<<g,g+=8),E+=d&(1<<_)-1,d>>>=_,g-=_),g<15&&(d+=v[n++]<<g,g+=8,d+=v[n++]<<g,g+=8),x=k[d&S];i:for(;;){if(_=x>>>24,d>>>=_,g-=_,_=x>>>16&255,_&16){if(O=x&65535,_&=15,g<_&&(d+=v[n++]<<g,g+=8,g<_&&(d+=v[n++]<<g,g+=8)),O+=d&(1<<_)-1,O>f){i.msg="invalid distance too far back",m.mode=Kt;break t}if(d>>>=_,g-=_,_=r-l,O>_){if(_=O-_,_>h&&m.sane){i.msg="invalid distance too far back",m.mode=Kt;break t}if(w=0,z=c,u===0){if(w+=s-_,_<E){E-=_;do b[r++]=c[w++];while(--_);w=r-O,z=b}}else if(u<_){if(w+=s+u-_,_-=u,_<E){E-=_;do b[r++]=c[w++];while(--_);if(w=0,u<E){_=u,E-=_;do b[r++]=c[w++];while(--_);w=r-O,z=b}}}else if(w+=u-_,_<E){E-=_;do b[r++]=c[w++];while(--_);w=r-O,z=b}for(;E>2;)b[r++]=z[w++],b[r++]=z[w++],b[r++]=z[w++],E-=3;E&&(b[r++]=z[w++],E>1&&(b[r++]=z[w++]))}else{w=r-O;do b[r++]=b[w++],b[r++]=b[w++],b[r++]=b[w++],E-=3;while(E>2);E&&(b[r++]=b[w++],E>1&&(b[r++]=b[w++]))}}else if(_&64){i.msg="invalid distance code",m.mode=Kt;break t}else{x=k[(x&65535)+(d&(1<<_)-1)];continue i}break}}else if(_&64)if(_&32){m.mode=lr;break t}else{i.msg="invalid literal/length code",m.mode=Kt;break t}else{x=I[(x&65535)+(d&(1<<_)-1)];continue e}break}}while(n<a&&r<o);E=g>>3,n-=E,g-=E<<3,d&=(1<<g)-1,i.next_in=n,i.next_out=r,i.avail_in=n<a?5+(a-n):5-(n-a),i.avail_out=r<o?257+(o-r):257-(r-o),m.hold=d,m.bits=g};const dt=15,Xe=852,Ge=592,Ye=0,se=1,qe=2,sr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),cr=(t,i,e,n,a,r,l,o)=>{const f=o.bits;let s=0,h=0,u=0,c=0,d=0,g=0,I=0,k=0,p=0,S=0,x,_,E,O,w,z=null,v;const b=new Uint16Array(dt+1),m=new Uint16Array(dt+1);let et=null,Ue,Ht,Ft;for(s=0;s<=dt;s++)b[s]=0;for(h=0;h<n;h++)b[i[e+h]]++;for(d=f,c=dt;c>=1&&b[c]===0;c--);if(d>c&&(d=c),c===0)return a[r++]=1<<24|64<<16|0,a[r++]=1<<24|64<<16|0,o.bits=1,0;for(u=1;u<c&&b[u]===0;u++);for(d<u&&(d=u),k=1,s=1;s<=dt;s++)if(k<<=1,k-=b[s],k<0)return-1;if(k>0&&(t===Ye||c!==1))return-1;for(m[1]=0,s=1;s<dt;s++)m[s+1]=m[s]+b[s];for(h=0;h<n;h++)i[e+h]!==0&&(l[m[i[e+h]]++]=h);if(t===Ye?(z=et=l,v=20):t===se?(z=sr,et=hr,v=257):(z=fr,et=dr,v=0),S=0,h=0,s=u,w=r,g=d,I=0,E=-1,p=1<<d,O=p-1,t===se&&p>Xe||t===qe&&p>Ge)return 1;for(;;){Ue=s-I,l[h]+1<v?(Ht=0,Ft=l[h]):l[h]>=v?(Ht=et[l[h]-v],Ft=z[l[h]-v]):(Ht=32+64,Ft=0),x=1<<s-I,_=1<<g,u=_;do _-=x,a[w+(S>>I)+_]=Ue<<24|Ht<<16|Ft|0;while(_!==0);for(x=1<<s-1;S&x;)x>>=1;if(x!==0?(S&=x-1,S+=x):S=0,h++,--b[s]===0){if(s===c)break;s=i[e+l[h]]}if(s>d&&(S&O)!==E){for(I===0&&(I=d),w+=u,g=s-I,k=1<<g;g+I<c&&(k-=b[g+I],!(k<=0));)g++,k<<=1;if(p+=1<<g,t===se&&p>Xe||t===qe&&p>Ge)return 1;E=S&O,a[E]=d<<24|g<<16|w-r|0}}return S!==0&&(a[w+S]=s-I<<24|64<<16|0),o.bits=d,0};var St=cr;const _r=0,Yi=1,qi=2,{Z_FINISH:We,Z_BLOCK:ur,Z_TREES:jt,Z_OK:ot,Z_STREAM_END:gr,Z_NEED_DICT:wr,Z_STREAM_ERROR:H,Z_DATA_ERROR:Wi,Z_MEM_ERROR:Ji,Z_BUF_ERROR:br,Z_DEFLATED:Je}=st,ee=16180,Ve=16181,Qe=16182,ti=16183,ei=16184,ii=16185,ni=16186,ai=16187,ri=16188,li=16189,Vt=16190,G=16191,he=16192,oi=16193,fe=16194,si=16195,hi=16196,fi=16197,di=16198,Xt=16199,Gt=16200,ci=16201,_i=16202,ui=16203,gi=16204,wi=16205,de=16206,bi=16207,pi=16208,R=16209,Vi=16210,Qi=16211,pr=852,xr=592,mr=15,yr=mr,xi=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function kr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ht=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.mode<ee||i.mode>Qi?1:0},tn=t=>{if(ht(t))return H;const i=t.state;return t.total_in=t.total_out=i.total=0,t.msg="",i.wrap&&(t.adler=i.wrap&1),i.mode=ee,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(pr),i.distcode=i.distdyn=new Int32Array(xr),i.sane=1,i.back=-1,ot},en=t=>{if(ht(t))return H;const i=t.state;return i.wsize=0,i.whave=0,i.wnext=0,tn(t)},nn=(t,i)=>{let e;if(ht(t))return H;const n=t.state;return i<0?(e=0,i=-i):(e=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?H:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=e,n.wbits=i,en(t))},an=(t,i)=>{if(!t)return H;const e=new kr;t.state=e,e.strm=t,e.window=null,e.mode=ee;const n=nn(t,i);return n!==ot&&(t.state=null),n},vr=t=>an(t,yr);let mi=!0,ce,_e;const Er=t=>{if(mi){ce=new Int32Array(512),_e=new Int32Array(32);let i=0;for(;i<144;)t.lens[i++]=8;for(;i<256;)t.lens[i++]=9;for(;i<280;)t.lens[i++]=7;for(;i<288;)t.lens[i++]=8;for(St(Yi,t.lens,0,288,ce,0,t.work,{bits:9}),i=0;i<32;)t.lens[i++]=5;St(qi,t.lens,0,32,_e,0,t.work,{bits:5}),mi=!1}t.lencode=ce,t.lenbits=9,t.distcode=_e,t.distbits=5},rn=(t,i,e,n)=>{let a;const r=t.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(i.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),r.window.set(i.subarray(e-n,e-n+a),r.wnext),n-=a,n?(r.window.set(i.subarray(e-n,e),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0},Tr=(t,i)=>{let e,n,a,r,l,o,f,s,h,u,c,d,g,I,k=0,p,S,x,_,E,O,w,z;const v=new Uint8Array(4);let b,m;const et=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ht(t)||!t.output||!t.input&&t.avail_in!==0)return H;e=t.state,e.mode===G&&(e.mode=he),l=t.next_out,a=t.output,f=t.avail_out,r=t.next_in,n=t.input,o=t.avail_in,s=e.hold,h=e.bits,u=o,c=f,z=ot;t:for(;;)switch(e.mode){case ee:if(e.wrap===0){e.mode=he;break}for(;h<16;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(e.wrap&2&&s===35615){e.wbits===0&&(e.wbits=15),e.check=0,v[0]=s&255,v[1]=s>>>8&255,e.check=Z(e.check,v,2,0),s=0,h=0,e.mode=Ve;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((s&255)<<8)+(s>>8))%31){t.msg="incorrect header check",e.mode=R;break}if((s&15)!==Je){t.msg="unknown compression method",e.mode=R;break}if(s>>>=4,h-=4,w=(s&15)+8,e.wbits===0&&(e.wbits=w),w>15||w>e.wbits){t.msg="invalid window size",e.mode=R;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=s&512?li:G,s=0,h=0;break;case Ve:for(;h<16;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(e.flags=s,(e.flags&255)!==Je){t.msg="unknown compression method",e.mode=R;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=R;break}e.head&&(e.head.text=s>>8&1),e.flags&512&&e.wrap&4&&(v[0]=s&255,v[1]=s>>>8&255,e.check=Z(e.check,v,2,0)),s=0,h=0,e.mode=Qe;case Qe:for(;h<32;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}e.head&&(e.head.time=s),e.flags&512&&e.wrap&4&&(v[0]=s&255,v[1]=s>>>8&255,v[2]=s>>>16&255,v[3]=s>>>24&255,e.check=Z(e.check,v,4,0)),s=0,h=0,e.mode=ti;case ti:for(;h<16;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}e.head&&(e.head.xflags=s&255,e.head.os=s>>8),e.flags&512&&e.wrap&4&&(v[0]=s&255,v[1]=s>>>8&255,e.check=Z(e.check,v,2,0)),s=0,h=0,e.mode=ei;case ei:if(e.flags&1024){for(;h<16;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}e.length=s,e.head&&(e.head.extra_len=s),e.flags&512&&e.wrap&4&&(v[0]=s&255,v[1]=s>>>8&255,e.check=Z(e.check,v,2,0)),s=0,h=0}else e.head&&(e.head.extra=null);e.mode=ii;case ii:if(e.flags&1024&&(d=e.length,d>o&&(d=o),d&&(e.head&&(w=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(r,r+d),w)),e.flags&512&&e.wrap&4&&(e.check=Z(e.check,n,d,r)),o-=d,r+=d,e.length-=d),e.length))break t;e.length=0,e.mode=ni;case ni:if(e.flags&2048){if(o===0)break t;d=0;do w=n[r+d++],e.head&&w&&e.length<65536&&(e.head.name+=String.fromCharCode(w));while(w&&d<o);if(e.flags&512&&e.wrap&4&&(e.check=Z(e.check,n,d,r)),o-=d,r+=d,w)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=ai;case ai:if(e.flags&4096){if(o===0)break t;d=0;do w=n[r+d++],e.head&&w&&e.length<65536&&(e.head.comment+=String.fromCharCode(w));while(w&&d<o);if(e.flags&512&&e.wrap&4&&(e.check=Z(e.check,n,d,r)),o-=d,r+=d,w)break t}else e.head&&(e.head.comment=null);e.mode=ri;case ri:if(e.flags&512){for(;h<16;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(e.wrap&4&&s!==(e.check&65535)){t.msg="header crc mismatch",e.mode=R;break}s=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=G;break;case li:for(;h<32;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}t.adler=e.check=xi(s),s=0,h=0,e.mode=Vt;case Vt:if(e.havedict===0)return t.next_out=l,t.avail_out=f,t.next_in=r,t.avail_in=o,e.hold=s,e.bits=h,wr;t.adler=e.check=1,e.mode=G;case G:if(i===ur||i===jt)break t;case he:if(e.last){s>>>=h&7,h-=h&7,e.mode=de;break}for(;h<3;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}switch(e.last=s&1,s>>>=1,h-=1,s&3){case 0:e.mode=oi;break;case 1:if(Er(e),e.mode=Xt,i===jt){s>>>=2,h-=2;break t}break;case 2:e.mode=hi;break;case 3:t.msg="invalid block type",e.mode=R}s>>>=2,h-=2;break;case oi:for(s>>>=h&7,h-=h&7;h<32;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if((s&65535)!==(s>>>16^65535)){t.msg="invalid stored block lengths",e.mode=R;break}if(e.length=s&65535,s=0,h=0,e.mode=fe,i===jt)break t;case fe:e.mode=si;case si:if(d=e.length,d){if(d>o&&(d=o),d>f&&(d=f),d===0)break t;a.set(n.subarray(r,r+d),l),o-=d,r+=d,f-=d,l+=d,e.length-=d;break}e.mode=G;break;case hi:for(;h<14;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(e.nlen=(s&31)+257,s>>>=5,h-=5,e.ndist=(s&31)+1,s>>>=5,h-=5,e.ncode=(s&15)+4,s>>>=4,h-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=R;break}e.have=0,e.mode=fi;case fi:for(;e.have<e.ncode;){for(;h<3;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}e.lens[et[e.have++]]=s&7,s>>>=3,h-=3}for(;e.have<19;)e.lens[et[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,b={bits:e.lenbits},z=St(_r,e.lens,0,19,e.lencode,0,e.work,b),e.lenbits=b.bits,z){t.msg="invalid code lengths set",e.mode=R;break}e.have=0,e.mode=di;case di:for(;e.have<e.nlen+e.ndist;){for(;k=e.lencode[s&(1<<e.lenbits)-1],p=k>>>24,S=k>>>16&255,x=k&65535,!(p<=h);){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(x<16)s>>>=p,h-=p,e.lens[e.have++]=x;else{if(x===16){for(m=p+2;h<m;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(s>>>=p,h-=p,e.have===0){t.msg="invalid bit length repeat",e.mode=R;break}w=e.lens[e.have-1],d=3+(s&3),s>>>=2,h-=2}else if(x===17){for(m=p+3;h<m;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}s>>>=p,h-=p,w=0,d=3+(s&7),s>>>=3,h-=3}else{for(m=p+7;h<m;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}s>>>=p,h-=p,w=0,d=11+(s&127),s>>>=7,h-=7}if(e.have+d>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=R;break}for(;d--;)e.lens[e.have++]=w}}if(e.mode===R)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=R;break}if(e.lenbits=9,b={bits:e.lenbits},z=St(Yi,e.lens,0,e.nlen,e.lencode,0,e.work,b),e.lenbits=b.bits,z){t.msg="invalid literal/lengths set",e.mode=R;break}if(e.distbits=6,e.distcode=e.distdyn,b={bits:e.distbits},z=St(qi,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,b),e.distbits=b.bits,z){t.msg="invalid distances set",e.mode=R;break}if(e.mode=Xt,i===jt)break t;case Xt:e.mode=Gt;case Gt:if(o>=6&&f>=258){t.next_out=l,t.avail_out=f,t.next_in=r,t.avail_in=o,e.hold=s,e.bits=h,or(t,c),l=t.next_out,a=t.output,f=t.avail_out,r=t.next_in,n=t.input,o=t.avail_in,s=e.hold,h=e.bits,e.mode===G&&(e.back=-1);break}for(e.back=0;k=e.lencode[s&(1<<e.lenbits)-1],p=k>>>24,S=k>>>16&255,x=k&65535,!(p<=h);){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(S&&!(S&240)){for(_=p,E=S,O=x;k=e.lencode[O+((s&(1<<_+E)-1)>>_)],p=k>>>24,S=k>>>16&255,x=k&65535,!(_+p<=h);){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}s>>>=_,h-=_,e.back+=_}if(s>>>=p,h-=p,e.back+=p,e.length=x,S===0){e.mode=wi;break}if(S&32){e.back=-1,e.mode=G;break}if(S&64){t.msg="invalid literal/length code",e.mode=R;break}e.extra=S&15,e.mode=ci;case ci:if(e.extra){for(m=e.extra;h<m;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}e.length+=s&(1<<e.extra)-1,s>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=_i;case _i:for(;k=e.distcode[s&(1<<e.distbits)-1],p=k>>>24,S=k>>>16&255,x=k&65535,!(p<=h);){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(!(S&240)){for(_=p,E=S,O=x;k=e.distcode[O+((s&(1<<_+E)-1)>>_)],p=k>>>24,S=k>>>16&255,x=k&65535,!(_+p<=h);){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}s>>>=_,h-=_,e.back+=_}if(s>>>=p,h-=p,e.back+=p,S&64){t.msg="invalid distance code",e.mode=R;break}e.offset=x,e.extra=S&15,e.mode=ui;case ui:if(e.extra){for(m=e.extra;h<m;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}e.offset+=s&(1<<e.extra)-1,s>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=R;break}e.mode=gi;case gi:if(f===0)break t;if(d=c-f,e.offset>d){if(d=e.offset-d,d>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=R;break}d>e.wnext?(d-=e.wnext,g=e.wsize-d):g=e.wnext-d,d>e.length&&(d=e.length),I=e.window}else I=a,g=l-e.offset,d=e.length;d>f&&(d=f),f-=d,e.length-=d;do a[l++]=I[g++];while(--d);e.length===0&&(e.mode=Gt);break;case wi:if(f===0)break t;a[l++]=e.length,f--,e.mode=Gt;break;case de:if(e.wrap){for(;h<32;){if(o===0)break t;o--,s|=n[r++]<<h,h+=8}if(c-=f,t.total_out+=c,e.total+=c,e.wrap&4&&c&&(t.adler=e.check=e.flags?Z(e.check,a,c,l-c):Ot(e.check,a,c,l-c)),c=f,e.wrap&4&&(e.flags?s:xi(s))!==e.check){t.msg="incorrect data check",e.mode=R;break}s=0,h=0}e.mode=bi;case bi:if(e.wrap&&e.flags){for(;h<32;){if(o===0)break t;o--,s+=n[r++]<<h,h+=8}if(e.wrap&4&&s!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=R;break}s=0,h=0}e.mode=pi;case pi:z=gr;break t;case R:z=Wi;break t;case Vi:return Ji;case Qi:default:return H}return t.next_out=l,t.avail_out=f,t.next_in=r,t.avail_in=o,e.hold=s,e.bits=h,(e.wsize||c!==t.avail_out&&e.mode<R&&(e.mode<de||i!==We))&&rn(t,t.output,t.next_out,c-t.avail_out),u-=t.avail_in,c-=t.avail_out,t.total_in+=u,t.total_out+=c,e.total+=c,e.wrap&4&&c&&(t.adler=e.check=e.flags?Z(e.check,a,c,t.next_out-c):Ot(e.check,a,c,t.next_out-c)),t.data_type=e.bits+(e.last?64:0)+(e.mode===G?128:0)+(e.mode===Xt||e.mode===fe?256:0),(u===0&&c===0||i===We)&&z===ot&&(z=br),z},Sr=t=>{if(ht(t))return H;let i=t.state;return i.window&&(i.window=null),t.state=null,ot},Ar=(t,i)=>{if(ht(t))return H;const e=t.state;return e.wrap&2?(e.head=i,i.done=!1,ot):H},zr=(t,i)=>{const e=i.length;let n,a,r;return ht(t)||(n=t.state,n.wrap!==0&&n.mode!==Vt)?H:n.mode===Vt&&(a=1,a=Ot(a,i,e,0),a!==n.check)?Wi:(r=rn(t,i,e,e),r?(n.mode=Vi,Ji):(n.havedict=1,ot))};var Ir=en,Rr=nn,Dr=tn,Or=vr,Zr=an,Mr=Tr,Ur=Sr,Nr=Ar,Br=zr,Lr="pako inflate (from Nodeca project)",q={inflateReset:Ir,inflateReset2:Rr,inflateResetKeep:Dr,inflateInit:Or,inflateInit2:Zr,inflate:Mr,inflateEnd:Ur,inflateGetHeader:Nr,inflateSetDictionary:Br,inflateInfo:Lr};function Cr(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var $r=Cr;const ln=Object.prototype.toString,{Z_NO_FLUSH:Hr,Z_FINISH:Fr,Z_OK:Ut,Z_STREAM_END:ue,Z_NEED_DICT:ge,Z_STREAM_ERROR:Pr,Z_DATA_ERROR:yi,Z_MEM_ERROR:Kr}=st;function $t(t){this.options=te.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(t&&t.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15||(i.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let e=q.inflateInit2(this.strm,i.windowBits);if(e!==Ut)throw new Error(rt[e]);if(this.header=new $r,q.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=Mt.string2buf(i.dictionary):ln.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(e=q.inflateSetDictionary(this.strm,i.dictionary),e!==Ut)))throw new Error(rt[e])}$t.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let r,l,o;if(this.ended)return!1;for(i===~~i?l=i:l=i===!0?Fr:Hr,ln.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),r=q.inflate(e,l),r===ge&&a&&(r=q.inflateSetDictionary(e,a),r===Ut?r=q.inflate(e,l):r===yi&&(r=ge));e.avail_in>0&&r===ue&&e.state.wrap>0&&t[e.next_in]!==0;)q.inflateReset(e),r=q.inflate(e,l);switch(r){case Pr:case yi:case ge:case Kr:return this.onEnd(r),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||r===ue))if(this.options.to==="string"){let f=Mt.utf8border(e.output,e.next_out),s=e.next_out-f,h=Mt.buf2string(e.output,f);e.next_out=s,e.avail_out=n-s,s&&e.output.set(e.output.subarray(f,f+s),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(r===Ut&&o===0)){if(r===ue)return r=q.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};$t.prototype.onData=function(t){this.chunks.push(t)};$t.prototype.onEnd=function(t){t===Ut&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=te.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Oe(t,i){const e=new $t(i);if(e.push(t),e.err)throw e.msg||rt[e.err];return e.result}function jr(t,i){return i=i||{},i.raw=!0,Oe(t,i)}var Xr=$t,Gr=Oe,Yr=jr,qr=Oe,Wr=st,Jr={Inflate:Xr,inflate:Gr,inflateRaw:Yr,ungzip:qr,constants:Wr};const{Deflate:Vr,deflate:Qr,deflateRaw:tl,gzip:el}=rr,{Inflate:il,inflate:nl,inflateRaw:al,ungzip:rl}=Jr;var ll=Vr,ol=Qr,sl=tl,hl=el,fl=il,dl=nl,cl=al,_l=rl,ul=st,on={Deflate:ll,deflate:ol,deflateRaw:sl,gzip:hl,Inflate:fl,inflate:dl,inflateRaw:cl,ungzip:_l,constants:ul};const sn={};function Ze(t){return sn[t.name]=t,t}function gl(t,i){if(i instanceof Object&&i.class!==void 0){const e=sn[i.class];if(e)return e.from(i.data)}return i}var hn=(t=>(t.IHDR="IHDR",t.IDAT="IDAT",t.IEND="IEND",t.zTXt="zTXt",t))(hn||{});const ut=String.fromCharCode(137,80,78,71,13,10,26,10),ct="data:image/png;base64,";class At{constructor(i,e,n){A(this,"filename");A(this,"metadata");A(this,"imageBytes");if(this.filename=i,this.metadata=e,n instanceof HTMLCanvasElement)this.imageBytes=Yt(n.toDataURL("image/png").substring(ct.length));else if(n instanceof HTMLImageElement)this.imageBytes=Yt(n.src.substring(ct.length));else if(n instanceof ImageBitmap){const a=document.createElement("canvas");a.width=n.width,a.height=n.height;const r=a.getContext("2d");if(!r)throw new Error("failed to create canvas");r.imageSmoothingEnabled=!1,r.resetTransform(),r.drawImage(n,0,0),this.imageBytes=Yt(a.toDataURL("image/png").substring(ct.length))}else if(n instanceof ArrayBuffer)this.imageBytes=new Uint8Array(n),Object.assign(this.metadata,we(this.imageBytes)||{});else if(n.startsWith(ct))this.imageBytes=Yt(n.slice(ct.length)),Object.assign(this.metadata,we(this.imageBytes)||{});else if(n.startsWith(ut))this.imageBytes=Uint8Array.from(n,a=>a.codePointAt(0)||0),Object.assign(this.metadata,we(this.imageBytes)||{});else throw new Error("img is not a PNG")}download(){const i=document.createElement("a");i.href=this.dataURL(),i.download=`${this.filename}.png`,i.click()}dataURL(){return ct+ml(wl(this.imageBytes,this.metadata))}bitmap(){return new Promise((i,e)=>{const n=document.createElement("img");n.onload=()=>{createImageBitmap(n).then(i).catch(e)},n.src=this.dataURL()})}static fromFile(i){return new Promise((e,n)=>{bn(i).then(a=>{a.startsWith(ut)?e(new At(i.name,{},a)):n("file is not a PNG")})})}}function we(t){for(let i of dn(t))if(fn(i))return JSON.parse(new TextDecoder().decode(on.inflate(i.data)),gl)}function wl(t,i){const e=dn(t);if(Object.keys(i).length>0){const n=e.findIndex(fn),a={type:"zTXt",data:on.deflate(JSON.stringify(i))};n===-1?e.splice(1,0,a):e[n]=a}return bl(e)}function fn(t){return t.type==="zTXt"}function dn(t){t=t.subarray(ut.length);const i=[];for(;t.length;){let e=pl(String.fromCodePoint(...t.subarray(0,4)));e<0&&(e=0);const n=t.subarray(0,e+12);t=t.subarray(e+12);const a=String.fromCodePoint(...n.subarray(4,8));let r=new Uint8Array;e>0&&(r=n.subarray(8,e+8)),i.push({type:a,data:r})}return i}function bl(t){const i=[];let e=0;for(let r of t)if(Object.values(hn).includes(r.type)){const l=new Uint8Array(8+r.type.length+r.data.length);l.set(ki(r.data.length,4)),l.set(Uint8Array.from(r.type,o=>o.codePointAt(0)||0),4),l.set(r.data,4+r.type.length),l.set(ki(xl(l.subarray(4,-4)),4),4+r.type.length+r.data.length),i.push(l),e+=l.length}const n=new Uint8Array(ut.length+e);n.set(Uint8Array.from(ut,r=>r.codePointAt(0)||0));let a=ut.length;return i.forEach(r=>{n.set(r,a),a+=r.length}),n}function ki(t,i){const e=new Uint8Array(i);let n=i-1;for(;n>=0;){const a=t&255;e[n--]=a,t=t>>8}return e}function pl(t){let i=0;for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);i=i<<8|n&255}return i}function xl(t){const i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];let e=-1;for(let n=0;n<t.length;n++)e=e>>>8^i[(e^t[n])&255];return(e^-1)>>>0}function Yt(t){const i=atob(t);return Uint8Array.from(i,e=>e.codePointAt(0)||0)}function ml(t){const i=String.fromCodePoint(...t);return btoa(i)}class D{constructor(i,e){A(this,"x");A(this,"y");this.x=i,this.y=e}add(i,e){return new D(this.x+i,this.y+e)}floor(){return new D(Math.floor(this.x),Math.floor(this.y))}dist(i){return Math.sqrt(Math.pow(i.x-this.x,2)+Math.pow(i.y-this.y,2))}clone(){return new D(this.x,this.y)}equals(i){return i.x===this.x&&i.y===this.y}toString(){return`${this.x},${this.y}`}toJSON(){return{class:"Point",data:{x:this.x,y:this.y}}}static from(i){if(typeof i=="string"){const[e,n]=i.split(",").map(a=>parseInt(a));return new D(e,n)}return new D(i.x,i.y)}}Ze(D);class gt{constructor(){A(this,"data",{})}set(i,e,n){const a=i.toString();this.data[a]||(this.data[a]={}),this.data[a][e]=n}get(i,e,n){const a=i.toString();return this.data[a]?this.data[a][e]:n}filter(i){return Object.entries(this.data).filter(([e,n])=>n[i]!==void 0).map(([e,n])=>[D.from(e),n[i]])}toJSON(){return{class:"Tiledata",data:this.data}}static from(i){const e=new gt;return e.data=i,e}}Ze(gt);class yl{constructor(){A(this,"stack",[])}push(i){this.stack.push(i)}undo(i){for(let e of this.stack.toReversed())e.undo(i)}redo(i){for(let e of this.stack)e.redo(i)}}class kl{constructor(i,e=20){A(this,"_constructor");A(this,"undoable");A(this,"undoStack",[]);A(this,"redoStack",[]);A(this,"maxUndo");this._constructor=i,this.maxUndo=e}begin(){this.undoable&&(this.undoStack.push(this.undoable),this.undoStack.length>=this.maxUndo&&this.undoStack.splice(0,1)),this.undoable=new this._constructor}end(){this.undoable&&(this.undoStack.push(this.undoable),this.undoStack.length>=this.maxUndo&&this.undoStack.splice(0,1),this.undoable=void 0)}push(){const i=new this._constructor;return(this.undoable||this.undoStack).push(i),this.undoStack.length>=this.maxUndo&&this.undoStack.splice(0,1),i}undo(i){const e=this.undoStack.pop();e&&(e.undo(i),this.redoStack.push(e))}redo(i){const e=this.redoStack.pop();e&&(e.redo(i),this.undoStack.push(e),this.undoStack.length>=this.maxUndo&&this.undoStack.splice(0,1))}}function Zl(t,i,e,n){const a=2*Math.PI/6;t.beginPath();for(var r=0;r<6;r++)t.lineTo(i+n*Math.cos(a*r),e+n*Math.sin(a*r));t.closePath(),t.stroke()}function Ml(t,i,e,n,a){t.beginPath(),t.lineTo(i,e),t.lineTo(i+n,e),t.lineTo(i+n,e+a),t.lineTo(i,e+a),t.closePath(),t.stroke()}function Nt(t,i){const e=i||new ImageData(t.width,t.height);for(let n=0;n<t.height;n++)for(let a=0;a<t.width;a++){const r=(n*t.width+a)*4;e.data[r+0]=t.data[r+0],e.data[r+1]=t.data[r+1],e.data[r+2]=t.data[r+2],e.data[r+3]=t.data[r+3]}return e}function vi(t){for(let i=0;i<t.height;i++)for(let e=0;e<t.width;e++){const n=(i*t.width+e)*4;t.data[n+0]=0,t.data[n+1]=0,t.data[n+2]=0,t.data[n+3]=0}return t}function vl(t,i){const[e,n]=[t.width,t.height],a=new ImageData(e,n);for(let r=0;r<e;r++)for(let l=0;l<n;l++){const o=(l*e+r)*4,f=i==="y"?(l*e+(e-r-1))*4:((n-l-1)*e+r)*4;a.data[o+0]=t.data[f+0],a.data[o+1]=t.data[f+1],a.data[o+2]=t.data[f+2],a.data[o+3]=t.data[f+3]}Nt(a,t)}function El(t,i,e){const[n,a]=[t.width,t.height],r=new ImageData(n,a);for(let l=0;l<n;l++)for(let o=0;o<a;o++){const[f,s]=[l+i,o+e];if(f<0||f>=n||s<0||s>=a)continue;const h=(o*n+l)*4,u=(s*n+f)*4;r.data[u+0]=t.data[h+0],r.data[u+1]=t.data[h+1],r.data[u+2]=t.data[h+2],r.data[u+3]=t.data[h+3]}Nt(r,t)}function Ei(t){const i=new Set;for(let e=0;e<t.width*t.height*4;e+=4){const n=t.data[e+0],a=t.data[e+1],r=t.data[e+2],l=t.data[e+3];(n||a||r||l)&&i.add("#"+n.toString(16)+a.toString(16)+r.toString(16)+l.toString(16))}return i}function Tl(t,i){const n=Sl(t.data),a=cn(n,t.width,t.height,8);let{rotated:r,rotW:l,rotH:o}=Al(a,t.width*8,t.height*8,i),{downscaled:f,width:s,height:h}=_n(r,l,o,8,2);return new ImageData(new Uint8ClampedArray(zl(f)),s,h)}const Sl=t=>t.reduce((i,e,n,a)=>n%4===0?i.concat(un(a.slice(n,n+4))):i,[]),cn=(t,i,e,n)=>{if(n===1)return t;let a=new Array(t.length*4),r=0,l=0;for(let o=0;o<e;o++){l+=i*2;for(let f=0;f<i;f++){const s=t[F(i,o,f)],h=o>0?t[F(i,o-1,f)]:s,u=f<i-1?t[F(i,o,f+1)]:s,c=f>0?t[F(i,o,f-1)]:s,d=o<e-1?t[F(i,o+1,f)]:s;a[r]=C(c,h)&&!C(c,d)&&!C(h,u)?h:s,r++,a[r]=C(h,u)&&!C(h,c)&&!C(u,d)?u:s,r++,a[l]=C(d,c)&&!C(d,u)&&!C(c,h)?c:s,l++,a[l]=C(u,d)&&!C(u,h)&&!C(d,c)?d:s,l++}r+=i*2}return cn(a,i*2,e*2,n/2)};function Al(t,i,e,n){const[a,r]=Il([i,e],n),l=Math.cos(n*Math.PI/180),o=Math.sin(n*Math.PI/180);let f=new Array(Math.round(a)*Math.round(r)),s=[];for(let h=0;h<r;h++){let u=[];for(let c=0;c<a;c++){const d=Math.round((c-a/2)*l+(h-r/2)*o+i/2),g=Math.round(-(c-a/2)*o+(h-r/2)*l+e/2);if(d>=0&&g>=0&&d<i&&g<e){f[F(a,h,c)]=t[F(i,g,d)];const I={x:c,color:t[F(i,g,d)]};u.push(I)}else f[F(a,h,c)]=un([0,255,255,0])}u.length&&s.push(u)}return{rotated:f,painted:s,rotW:a,rotH:r}}function _n(t,i,e,n,a=2){if(n===1)return{downscaled:t,width:i,height:e};const r=Math.ceil(e/a),l=Math.ceil(i/a);let o=new Array(r*l);for(let f=0;f<r;f++)for(let s=0;s<l;s++)o[F(l,f,s)]=t[F(i,f*a,s*a)];return _n(o,l,r,n/a,a)}const un=t=>`${t[0]}.${t[1]}.${t[2]}.${t[3]}`,F=(t,i,e)=>t*i+e,C=(t,i)=>t===i,zl=t=>t.map(i=>i.split(".").map(e=>Number(e))).flat(),Il=(t,i)=>{if(i=i%180,i<0&&(i=180+i),i>=90&&(t=[t[1],t[0]],i=i-90),i===0)return t;const e=i*Math.PI/180,n=t[0]*Math.cos(e)+t[1]*Math.sin(e),a=t[0]*Math.sin(e)+t[1]*Math.cos(e);return[n,a]};class Rl extends yl{constructor(){super(...arguments);A(this,"tiles",[]);A(this,"pixels",[])}addTile({loc:e,buf:n}){this.tiles.push({loc:e,buf:Nt(n)})}undo(e){super.undo(e);for(let n of this.tiles){const a=n.buf,r=e.getTileBuffer(n.loc);n.buf=r.buf,r.buf=a,e.rendering++,createImageBitmap(r.buf).then(l=>{var o;(o=r.img)==null||o.close(),r.img=l,e.rendering--})}for(let n of this.pixels){const a=e.getTileBuffer(n.tile),r=(n.pixel.y*a.buf.width+n.pixel.x)*4;a.buf.data[r+0]=n.from.r,a.buf.data[r+1]=n.from.g,a.buf.data[r+2]=n.from.b,a.buf.data[r+3]=n.from.a,e.rendering++,createImageBitmap(a.buf).then(l=>{var o;(o=a.img)==null||o.close(),a.img=l,e.rendering--})}}redo(e){var n;super.redo(e),(n=this.tiles)==null||n.forEach(a=>{const r=a.buf,l=e.getTileBuffer(a.loc);a.buf=l.buf,l.buf=r,e.rendering++,createImageBitmap(l.buf).then(o=>{var f;(f=l.img)==null||f.close(),l.img=o,e.rendering--})}),this.pixels.forEach(a=>{const r=e.getTileBuffer(a.tile),l=(a.pixel.y*r.buf.width+a.pixel.x)*4;r.buf.data[l+0]=a.to.r,r.buf.data[l+1]=a.to.g,r.buf.data[l+2]=a.to.b,r.buf.data[l+3]=a.to.a,e.rendering++,createImageBitmap(r.buf).then(o=>{var f;(f=r.img)==null||f.close(),r.img=o,e.rendering--})})}}class Me{constructor(){A(this,"name","");A(this,"img");A(this,"type","square");A(this,"tilewidth",0);A(this,"tileheight",0);A(this,"margin",0);A(this,"spacing",0);A(this,"tiledata",new gt);A(this,"tiles",[]);A(this,"rendering",0);A(this,"copyBuffer",[]);A(this,"selectedTiles",[]);A(this,"undoer",new kl(Rl))}worldToTile(i){return!this.tilewidth||!this.tileheight?new D(0,0):this.type==="hex"?Dl(new D(2/3*i.x/this.radius(),(-1/3*i.x+Math.sqrt(3)/3*i.y)/this.radius())):new D(Math.floor(i.x/this.tilewidth),Math.floor(i.y/this.tileheight))}tileToWorld(i){return!this.tilewidth||!this.tileheight?new D(0,0):this.type==="hex"?new D(this.radius()*(3/2)*i.x,this.radius()*(Math.sqrt(3)/2*i.x+Math.sqrt(3)*i.y)):new D(i.x*this.tilewidth,i.y*this.tileheight)}imgCoordsToTile(i){return!this.tilewidth||!this.tileheight?new D(0,0):new D(Math.floor((i.x-this.margin)/(this.tilewidth+this.spacing)),Math.floor((i.y-this.margin)/(this.tileheight+this.spacing)))}tileToImgCoords(i){return!this.tilewidth||!this.tileheight?new D(0,0):new D(i.x*(this.tilewidth+this.spacing)+this.margin,i.y*(this.tileheight+this.spacing)+this.margin)}radius(){return this.tilewidth/2}hexHeight(){return Math.ceil(Math.sqrt(3)*this.radius())}offsetWidth(){return this.tilewidth+this.spacing}offsetHeight(){return this.tileheight+this.spacing}clearSelectedTiles(){this.selectedTiles=[]}setSelectedTile(i){this.selectedTiles=[i]}toggleSelectedTile(i){const e=this.selectedTiles.findIndex(n=>n.equals(i));e!==-1?this.selectedTiles.splice(e,1):this.selectedTiles.push(i.clone())}palette(){let i=new Set;for(let e of this.selectedTiles){const n=this.getTileBuffer(e);i=new Set([...i,...Ei(n.buf)])}return i}setSelectionTags(i){this.selectedTiles.forEach(e=>{this.selectedTiles.length===1?this.tiledata.set(e,"tags",Array.from(i)):this.tiledata.set(e,"tags",Array.from(i))})}selectionTags(){let i=new Set;return this.selectedTiles.length===0?i:this.selectedTiles.length===1?new Set(this.tiledata.get(this.selectedTiles[0],"tags",[])):(this.selectedTiles.forEach(e=>{const n=new Set(this.tiledata.get(e,"tags",[]));i.size==0?i=n:i=new Set([...i].filter(a=>n.has(a)))}),i)}widthInTiles(){if(!this.img)return 0;const i=this.offsetWidth();return i===0?0:Math.ceil((this.img.width-this.margin)/i)}heightInTiles(){if(!this.img)return 0;const i=this.offsetHeight();return i===0?0:Math.ceil((this.img.height-this.margin)/i)}inBounds(i){var e,n;return i.x>=0&&i.x<=(((e=this.img)==null?void 0:e.width)||0)&&i.y>=0&&i.y<=(((n=this.img)==null?void 0:n.width)||0)}randSelectedTile(){if(this.selectedTiles.length!==0)return this.selectedTiles[Math.floor(Math.random()*this.selectedTiles.length)]}getTileBuffer(i){return this.tiles[i.y*this.widthInTiles()+i.x]}setPixel(i,e,n,a,r){const l=this.getTileBuffer(this.imgCoordsToTile(i));if(i.x=i.x%this.offsetWidth(),i.y=i.y%this.offsetHeight(),i.x>=this.tilewidth||i.y>=this.tilewidth)return;const o=(i.y*l.buf.width+i.x)*4,f={r:l.buf.data[o+0],g:l.buf.data[o+1],b:l.buf.data[o+2],a:l.buf.data[o+3]};if(f.r===e&&f.g===n&&f.b===a&&f.a===r)return;this.undoer.push().pixels.push({tile:l.loc,pixel:i,from:f,to:{r:e,g:n,b:a,a:r}}),l.buf.data[o+0]=e,l.buf.data[o+1]=n,l.buf.data[o+2]=a,l.buf.data[o+3]=r,this.rendering++,createImageBitmap(l.buf).then(h=>{var u;(u=l.img)==null||u.close(),l.img=h,this.rendering--})}undo(){this.undoer.undo(this)}redo(){this.undoer.redo(this)}cut(){this.copyBuffer=[];const i=this.undoer.push();for(let e of this.selectedTiles){const n=this.getTileBuffer(e);i.addTile(n),this.copyBuffer.push({loc:n.loc.clone(),buf:Nt(n.buf)}),n.buf=vi(n.buf),this.rendering++,createImageBitmap(n.buf).then(a=>{var r;(r=n.img)==null||r.close(),n.img=a,this.rendering--})}}copy(){this.copyBuffer=[];for(let i of this.selectedTiles){const e=this.getTileBuffer(i);this.copyBuffer.push({loc:e.loc.clone(),buf:Nt(e.buf)})}}paste(){if(this.selectedTiles.length===0||this.copyBuffer.length===0)return;const i=this.selectedTiles[0].x-this.copyBuffer[0].loc.x,e=this.selectedTiles[0].y-this.copyBuffer[0].loc.y,n=this.undoer.push();for(let a of this.copyBuffer){const r=this.getTileBuffer(a.loc.add(i,e));n.addTile(r),r.buf=a.buf,this.rendering++,createImageBitmap(r.buf).then(l=>{var o;(o=r.img)==null||o.close(),r.img=l,this.rendering--})}}flip(i){const e=this.undoer.push();for(let n of this.selectedTiles){const a=this.getTileBuffer(n);e.addTile(a),vl(a.buf,i),this.rendering++,createImageBitmap(a.buf).then(r=>{var l;(l=a.img)==null||l.close(),a.img=r,this.rendering--})}}rotate(i){const e=this.undoer.push();for(let n of this.selectedTiles){const a=this.getTileBuffer(n);e.addTile(a),a.buf=Tl(a.buf,i),this.rendering++,createImageBitmap(a.buf).then(r=>{var l;(l=a.img)==null||l.close(),a.img=r,this.rendering--})}}move(i,e){const n=this.undoer.push();for(let a of this.selectedTiles){const r=this.getTileBuffer(a);n.addTile(r),El(r.buf,i,e),this.rendering++,createImageBitmap(r.buf).then(l=>{var o;(o=r.img)==null||o.close(),r.img=l,this.rendering--})}}clear(){const i=this.undoer.push();for(let e of this.selectedTiles){const n=this.getTileBuffer(e);i.addTile(n),vi(n.buf),this.rendering++,createImageBitmap(n.buf).then(a=>{var r;(r=n.img)==null||r.close(),n.img=a,this.rendering--})}}drawTile(i,e,n){if(!this.img)return!0;const a=this.tileToWorld(e),r=this.tileToImgCoords(n);this.type==="hex"&&(a.x-=this.radius(),a.y-=this.hexHeight()+4);const l=this.getTileBuffer(n);l.img?i.drawImage(l.img,0,0,this.tilewidth,this.tileheight,a.x,a.y,this.tilewidth,this.tileheight):i.drawImage(this.img,r.x,r.y,this.tilewidth,this.tileheight,a.x,a.y,this.tilewidth,this.tileheight)}createTiles(){if(!this.img||!this.tilewidth||!this.tileheight||this.rendering)return;const i=document.createElement("canvas");i.width=this.tilewidth,i.height=this.tileheight;const e=i.getContext("2d");if(!e)return;const[n,a]=[this.widthInTiles(),this.heightInTiles()];this.tiles=[];for(let r=0;r<a;r++)for(let l=0;l<n;l++){e.clearRect(0,0,i.width,i.height);const o=new D(l,r),f=this.tileToImgCoords(o);e.drawImage(this.img,f.x,f.y,this.tilewidth,this.tileheight,0,0,this.tilewidth,this.tileheight);const s={loc:o,buf:e.getImageData(0,0,this.tilewidth,this.tileheight)};this.tiles.push(s),this.rendering++,createImageBitmap(s.buf).then(h=>{var u;(u=s.img)==null||u.close(),s.img=h,this.rendering--})}}async syncTiles(){if(this.rendering)throw new Error("cannot sync until tiles are fully rendered");let[i,e]=[0,0];for(let l of this.tiles)Ei(l.buf).size>0&&(i=Math.max(i,l.loc.x),e=Math.max(e,l.loc.y));const n=document.createElement("canvas");n.width=2*this.margin+this.offsetWidth()*(i+1),n.height=2*this.margin+this.offsetHeight()*(e+1);const a=n.getContext("2d");if(!a)return new Promise((l,o)=>o("cannot create ctx from canvas"));for(let l of this.tiles){if(!l.img)throw new Error("cannot sync until tiles are fully rendered");const o=this.margin+l.loc.x*this.offsetWidth(),f=this.margin+l.loc.y*this.offsetHeight();a.drawImage(l.img,o,f)}const r=a.getImageData(0,0,n.width,n.height);return this.img=await createImageBitmap(r),this}setImageFromDataURL(i){return new Promise((e,n)=>{const a=document.createElement("img");a.onload=()=>{createImageBitmap(a).then(r=>{this.img=r,this.createTiles(),e(this)})},a.src=i})}png(){if(this.img)return new At(this.name,{name:this.name,tilewidth:this.tilewidth,tileheight:this.tileheight,type:this.type,margin:this.margin,spacing:this.spacing,tiledata:this.tiledata},this.img)}toJSON(){var i;return{class:"Tileset",data:((i=this.png())==null?void 0:i.dataURL())||null}}download(){this.syncTiles().then(i=>{var e;(e=i.png())==null||e.download()})}static async from(i){let e;i instanceof File?e=await At.fromFile(i):e=new At("",{},i);const n=new Me;return Object.assign(n,e.metadata),await n.setImageFromDataURL(e.dataURL()),n.tiledata instanceof gt||(n.tiledata=new gt),n}}Ze(Me);function Dl(t){const i=Math.round(t.x),e=Math.round(t.y),n=t.x-i,a=t.y-e,r=Math.round(n+.5*a)*(n*n>=a*a?1:0),l=Math.round(a+.5*n)*(n*n<a*a?1:0);return new D(i+r,e+l)}export{D as P,Ze as R,Me as T,kl as U,Ml as a,At as b,gt as c,Zl as d,yl as e};
